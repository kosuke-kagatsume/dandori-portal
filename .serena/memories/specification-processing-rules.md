# 仕様書処理ルール（必須遵守）

## 概要
このルールは、PDF等の仕様書を受け取った際に、要件の漏れを防ぐための手順を定義する。
**すべての仕様書受領時に必ずこのルールに従うこと。**

---

## フェーズ1: 仕様書の受領と分析

### 1.1 仕様書を受け取ったら即座に全ページを確認する
- 複数ファイルがある場合は、すべて開いて内容を把握する
- 「後で見る」は禁止。必ず最初に全体像を把握する

### 1.2 各ページから要件を1行ずつ抽出する
- 1つの要件 = 1つのタスク（絶対に統合しない）
- 曖昧な表現は具体的に書き換える

**悪い例:**
```
- メンバー状況のフィルター修正
- ダッシュボードの改善
```

**良い例:**
```
- メンバー状況: 出勤時刻順を削除する
- メンバー状況: 社員番号順を追加する
- メンバー状況: 部署フィルターのデフォルト表示を「すべて」から「全部署」に変更
- メンバー状況: 社員番号を部署の上に表示する
- ダッシュボード: 「承認されたら件数が減ります」を「未承認の申請」に変更
```

### 1.3 画面ごと・権限ごとにグループ化する
```
## ダッシュボード
### 全権限共通
- [ ] 「出勤する」→「勤怠打刻」に名称変更
- [ ] 「有給申請」→「休暇申請」に名称変更

### 経営者権限
- [ ] 「ユーザー管理」ボタン追加（遷移先: ユーザー管理）

### 一般権限
- [ ] 「メンバー確認」ボタン追加（遷移先: メンバー状況）
```

---

## フェーズ2: タスクリストの確認

### 2.1 TodoWriteツールで全タスクを登録する
- 抽出した要件をすべてTodoリストに登録
- 登録前に実装を開始しない

### 2.2 ユーザーに確認を取る
以下のフォーマットで確認を依頼する：

```
## 抽出した要件一覧

### [画面名1]
1. 要件A
2. 要件B
3. 要件C

### [画面名2]
1. 要件D
2. 要件E

**合計: X件**

この理解で合っていますか？漏れや誤りがあれば教えてください。
```

### 2.3 ユーザーの承認を得てから実装開始
- 「はい」「OK」「進めて」等の明確な承認を得る
- 承認前に実装を開始しない

---

## フェーズ3: 実装

### 3.1 1タスクずつ実装する
- 複数タスクを同時に進めない
- 1つ完了したら、Todoを「completed」に更新

### 3.2 実装中に新たな課題を発見したら
- 即座にTodoリストに追加する
- ユーザーに報告する
- 勝手に判断して省略しない

### 3.3 関連ファイルの変更漏れに注意
- 1つの要件が複数ファイルに影響する場合がある
- 例: 権限別の表示 → コンポーネント + ストア + 設定画面

---

## フェーズ4: 検証

### 4.1 実装完了後、元の仕様書を再度開く
- PDFを1ページずつ開き直す
- 各要件について「実装したか？」を確認

### 4.2 チェックリスト形式で報告する
```
## 実装完了報告

### ダッシュボード (6/6 完了)
- [x] 「出勤する」→「勤怠打刻」
- [x] 「有給申請」→「休暇申請」
- [x] 「承認されたら件数が減ります」→「未承認の申請」
- [x] 経営者権限: ユーザー管理ボタン追加
- [x] 一般権限: メンバー確認ボタン追加
- [x] 勤怠打刻・休暇申請のON/OFF設定

### メンバー状況 (10/10 完了)
...
```

### 4.3 動作確認を依頼する
- 「動作確認をお願いします」と明示的に依頼
- ユーザーからのフィードバックを待つ

---

## フェーズ5: コンテキスト管理

### 5.1 長い会話では定期的に状況を整理する
- 10タスク以上ある場合、途中で進捗サマリーを出す
- 「残りX件」を明示する

### 5.2 会話が要約される前に記録を残す
- 重要な要件リストはメモリに保存する
- `write_memory` を使用して永続化

### 5.3 要約後に再開する場合
- まず元の仕様書（PDF）を再確認する
- 要約の「完了」を鵜呑みにしない
- 実際のコードと仕様書を突き合わせて検証する

---

## 禁止事項

1. **仕様書を読まずに実装を始めること**
2. **複数の要件を1つのタスクにまとめること**
3. **ユーザー確認なしで実装を完了とすること**
4. **元の仕様書に戻らず「完了」と報告すること**
5. **「たぶんできている」という曖昧な状態で次に進むこと**

---

## チェックリスト（毎回確認）

実装開始前:
- [ ] 全仕様書を確認したか？
- [ ] 1要件1タスクで分解したか？
- [ ] TodoWriteに登録したか？
- [ ] ユーザーに確認を取ったか？

実装完了時:
- [ ] 元の仕様書を再度開いて確認したか？
- [ ] 全タスクにチェックを入れたか？
- [ ] 漏れはないか？
- [ ] ユーザーに完了報告したか？

---

## このルールの適用タイミング

- PDFを受け取った時
- 仕様書・設計書を受け取った時
- 「〜を実装して」と複数の要件を含む依頼を受けた時
- 画面キャプチャ付きの修正依頼を受けた時

**例外なく、このルールに従うこと。**
