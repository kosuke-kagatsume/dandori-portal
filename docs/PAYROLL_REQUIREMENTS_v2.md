# 給与管理システム 追加機能要件定義書 v2.0

**作成日**: 2025-10-17
**最終更新**: 2025-10-17
**ステータス**: 要件確定

---

## 📋 目次

1. [優先順位](#優先順位)
2. [機能詳細](#機能詳細)
   - [①帳票出力機能](#①帳票出力機能)
   - [②マイナンバー管理](#②マイナンバー管理)
   - [③社労士権限](#③社労士権限)
   - [④入社ワークフロー](#④入社ワークフロー)
   - [⑤タスク管理](#⑤タスク管理)
   - [⑥標準報酬月額・住民税管理](#⑥標準報酬月額住民税管理)
3. [技術仕様](#技術仕様)
4. [データ保持期間](#データ保持期間)

---

## 🎯 優先順位

### フェーズ1（最優先・給与計算タイミング必須）
- ✅ **①帳票出力機能**（給与計算のタイミングで出力必要）

### フェーズ2（社労士連携必須・セット実装）
- ✅ **②マイナンバー管理**
- ✅ **③社労士権限**
  - ※E.マイナンバー管理とF.社労士権限は同タイミングで利用必須（社労士へ手続き依頼時にマイナンバーが必要なため）

### フェーズ3（入社業務効率化）
- ✅ **④入社ワークフロー**（個人情報入力→承認→登録）

### フェーズ4（進捗可視化）
- ✅ **⑤タスク管理**（入退社の進捗可視化）

### フェーズ5（年次更新業務）
- ✅ **⑥標準報酬月額・住民税の一括登録**（CSV）
  - ※標準報酬月額改定したばかりで住民税も登録済みのため急いでいない

---

## 📝 機能詳細

---

## ①帳票出力機能

### 目的
給与計算タイミングで必要な法定帳票・管理帳票を出力

### 要件

#### 1. 出力フォーマット
- ✅ **PDF出力**: 必須
- ✅ **Excel出力**: 必須
- ❌ **電子署名・タイムスタンプ**: 不要
  - **理由**: 訂正・削除の履歴が残るのであればタイムスタンプ不要（MF給与も同様）
  - **代替**: データの変更履歴を保存する仕組みで対応

#### 2. 帳票種類
- **給与明細書**: PDF/Excel
- **賞与明細書**: PDF/Excel
- **源泉徴収票**: PDF/Excel
- **給与台帳**: Excel
- **賃金台帳**: Excel
- **所得税徴収高計算書**: PDF/Excel
- **社会保険料算定基礎届**: PDF/Excel
- **労働保険料申告書**: PDF/Excel

#### 3. 法定様式準拠
- ✅ 帳票フォーマットは法定様式に準拠
- ✅ 年度による様式変更に対応可能な設計

#### 4. 出力条件
- 期間指定（年月、年度、四半期、カスタム期間）
- 従業員指定（全員、部門別、個別）
- 出力形式選択（PDF、Excel、両方）

#### 5. 履歴管理
- ✅ 出力履歴を記録（誰が、いつ、何を出力したか）
- ✅ 変更履歴を保存（訂正・削除の履歴）
- ✅ 再出力可能（過去データの再出力）

---

## ②マイナンバー管理

### 目的
マイナンバー法に準拠した厳格なセキュリティ管理

### 要件

#### 1. セキュリティ
- ✅ **暗号化**: 256bit SSL暗号化通信
- ✅ **公開鍵長**: 2048bit
- ✅ **保存時暗号化**: データベース保存時も暗号化

#### 2. アクセスログ（マイナンバー法準拠）
MFクラウドマイナンバーの機能を参考に実装：

- ✅ **ログイン履歴管理**: アクセス者を特定
- ✅ **表示履歴管理**: マイナンバーの表示を記録
- ✅ **出力履歴管理**: マイナンバーの出力履歴を管理

#### 3. アクセス権限
- **人事担当者**: 登録・参照・更新・削除
- **社労士**: 参照・出力（常時アクセス可能）
- **一般従業員**: 自分のマイナンバーのみ登録・参照
- **システム管理者**: ログ参照のみ（マイナンバー本体は参照不可）

#### 4. マスキング機能
- 一覧画面では下4桁のみ表示（例：************1234）
- 詳細画面で「表示」ボタンクリック時のみ全桁表示
- 表示時にログ記録

#### 5. 廃棄管理
- 退職者のマイナンバーは法定保存期間後に自動廃棄予告
- 廃棄実行時は管理者承認必須
- 廃棄履歴を記録

---

## ③社労士権限

### 目的
社労士がシステムにアクセスし、必要な情報を参照・出力できるようにする

### 要件

#### 1. アクセス範囲
- ✅ **常時アクセス可能**（現状MF給与と同様）
- ✅ **全従業員の情報を参照可能**
- ✅ **マイナンバー参照・出力可能**（手続き依頼時に必要）

#### 2. 参照可能情報
- 従業員基本情報
- マイナンバー
- 給与・賞与情報
- 社会保険情報
- 労働保険情報
- 扶養家族情報

#### 3. 出力可能帳票
- 社会保険手続き用書類（算定基礎届、月額変更届など）
- 労働保険手続き用書類
- 年末調整関連書類
- その他法定手続き書類

#### 4. 制限事項
- ❌ データの登録・更新・削除は不可（参照・出力のみ）
- ❌ システム設定の変更は不可
- ✅ アクセスログは記録

#### 5. セキュリティ
- 社労士専用のログインアカウント
- 二段階認証（推奨）
- アクセスログの記録（いつ、誰が、何を参照・出力したか）

---

## ④入社ワークフロー

### 目的
Googleフォームで収集している入社時の個人情報をシステム内で完結させ、承認フローを組み込む

### 要件

#### 1. 入力フォーム（Googleフォームから移行）

##### フォーム1: 入社案内（基本情報）
**注意**: フォームの詳細はアクセスできませんでしたが、通常以下の項目が含まれると想定
- 氏名（漢字・カナ）
- 生年月日
- 住所
- 連絡先（電話番号・メールアドレス）
- 緊急連絡先
- 学歴・職歴
- その他基本情報

##### フォーム2: 家族情報
- メールアドレス（必須）
- 従業員番号（任意、不明な場合は「-」）
- 苗字（漢字）（必須、全角、戸籍と同じ記載）
- 名前（漢字）（必須、全角）
- 配偶者の有無（必須、選択式：「あり」「なし」）

**配偶者ありの場合の追加項目**:
- 氏名（漢字）【配偶者】（必須、全角）
- 氏名（カナ）【配偶者】（必須、全角カナ）
- 続柄【配偶者】（必須）
- 生年月日【配偶者】（必須、日付入力）
- 同居の有無【配偶者】（必須、選択式：「あり」「なし」）

**家族①〜⑥**:
- 上記と同様の項目が最大6名分繰り返し

##### フォーム3: 給与等支払先口座
- メールアドレス（必須）
- 従業員番号（任意、不明な場合は「-」）
- 氏名（必須、戸籍と同じ記載、苗字と名前の間に全角スペース）
- 申請区分（必須、選択肢：「新規申請」「変更申請」）
- 口座振込同意（必須、チェックボックス）
- 銀行名（必須）
- 銀行コード（必須、4桁数字）
- 支店名（必須）
- 支店コード（必須、3桁数字）
- 口座番号（必須、7桁数字）
- 口座名義（カナ）（必須、全角カナ、苗字と名前の間に全角スペース）

##### フォーム4: 通勤経路
**注意**: フォームの詳細はアクセスできませんでしたが、通常以下の項目が含まれると想定
- 通勤手段（電車、バス、自転車、徒歩など）
- 経路詳細
- 定期券区間
- 通勤費用

#### 2. 承認フロー
```
本人入力 → 人事確認 → 承認 → システム登録
          ↓
          差し戻し（不備がある場合）
```

##### フロー詳細
1. **本人入力**
   - 新入社員が各フォームに情報を入力
   - 入力完了後、人事部に通知

2. **人事確認**
   - 人事担当者が入力内容を確認
   - 不備がある場合は差し戻し（コメント付き）
   - 問題なければ承認

3. **承認**
   - 承認後、システムに自動登録
   - 登録完了通知を本人・人事に送信

4. **差し戻し**
   - 本人に差し戻し通知
   - 本人が修正・再提出
   - 再度人事確認へ

5. **人事承認後の修正**
   - 人事承認後はシステム内で直接修正可能
   - 修正履歴を記録

#### 3. データ連携
- 承認完了後、以下のマスタに自動反映：
  - 従業員マスタ
  - 家族マスタ（扶養控除申告書に利用）
  - 口座マスタ（給与振込に利用）
  - 通勤経路マスタ（通勤手当計算に利用）

#### 4. 通知機能
- 本人が入力完了 → 人事に通知
- 人事が差し戻し → 本人に通知
- 人事が承認 → 本人・人事に通知
- システム登録完了 → 本人・人事に通知

---

## ⑤タスク管理

### 目的
入社・退社時の複雑な手続きを可視化し、漏れを防ぐ

### 要件

#### 1. 入社タスク例
- [ ] 入社案内フォーム入力
- [ ] 家族情報フォーム入力
- [ ] 給与振込口座フォーム入力
- [ ] 通勤経路フォーム入力
- [ ] 人事確認
- [ ] システム登録
- [ ] 労働条件通知書作成
- [ ] 雇用契約書作成
- [ ] 社会保険加入手続き
- [ ] 雇用保険加入手続き
- [ ] PCアサイン
- [ ] 各種システムアカウント作成
- [ ] 入社オリエンテーション実施

#### 2. 退社タスク例
- [ ] 退職届受理
- [ ] 退職日確定
- [ ] 引継ぎ完了確認
- [ ] 社会保険喪失手続き
- [ ] 雇用保険喪失手続き
- [ ] 離職票発行
- [ ] 源泉徴収票発行
- [ ] PCアカウント削除
- [ ] 各種システムアカウント削除
- [ ] 最終給与計算
- [ ] 退職金計算（該当者のみ）

#### 3. 進捗可視化
- タスク全体の進捗率表示
- 担当者別タスク一覧
- 期限管理（期限超過アラート）
- ステータス管理（未着手、進行中、完了、保留）

#### 4. テンプレート機能
- 入社タスクテンプレート
- 退社タスクテンプレート
- カスタムテンプレート作成可能

---

## ⑥標準報酬月額・住民税管理

### 目的
年次更新業務の効率化（標準報酬月額改定、住民税更新）

### 要件

#### 1. 標準報酬月額管理

##### CSVアップロード
**フォーマット**:
```csv
社員ID,名前,報酬月額,適用開始日
001,田中太郎,300000,2025-09-01
002,山田花子,350000,2025-09-01
```

- **社員ID**: 必須、システム内の社員IDと紐づけ
- **名前**: 確認用（社員IDでの紐づけを基本とするが、確認のため表示）
- **報酬月額**: 必須、標準報酬月額を自動計算
- **適用開始日**: 必須、YYYY-MM-DD形式

##### 標準報酬月額計算
- 報酬月額の範囲に基づいて標準報酬月額を自動選択
- 例：報酬月額 1,355,000円 〜 1,415,000円 → 標準報酬月額 1,380,000円（等級31）
- **現在のMF給与と同じ仕組み**（選択するほうが月額範囲を確認できるので登録しやすい）

##### 予約設定
- ✅ **2ヶ月先まで設定可能**
- 例：10月に12月の標準報酬月額を予約登録

##### 変更履歴
- ✅ **保持期間**: 5年間
- **法定保存期間**: 決定通知の日から2年間
- **実務保存期間**: 労働関係書類とあわせて5年間保存
- 履歴には以下を記録：
  - 変更日時
  - 変更者
  - 変更前の値
  - 変更後の値
  - 適用開始日
  - 変更理由（任意）

#### 2. 住民税管理

##### CSVアップロード（eLTAX連携）
**フォーマット**: eLTAX取込み用CSV
- データ区分
- 市区町村コード
- 納付年月
- 指定番号
- 件数
- 税額
- 督促手数料
- 延滞金
- 合計件数
- 合計金額
- 備考
- ダミー

**参考**: `/Users/dw100/Downloads/個人住民税（特別徴収）CSVレイアウト仕様書（CSVフォーマット）.xlsx`

##### 納付用データ出力
- ✅ **CSV出力**: eLTAXでCSV取込み→納付手続き
- ✅ **特別徴収のみ対応**（普通徴収は処理しない）

##### 納付先情報管理
- 市区町村コード
- 納付年月
- 指定番号
- 税額

---

## 🔧 技術仕様

### 1. セキュリティ
- **通信暗号化**: 256bit SSL
- **公開鍵長**: 2048bit
- **データベース暗号化**: マイナンバー等の機密情報
- **アクセスログ**: すべての参照・更新・削除操作を記録

### 2. データ保持期間

| データ種類 | 保持期間 | 法的根拠 |
|----------|---------|---------|
| 給与台帳 | 5年間 | 労働基準法109条 |
| 賃金台帳 | 5年間 | 労働基準法109条 |
| 源泉徴収票 | 7年間 | 法人税法施行規則67条 |
| 社会保険関連 | 2年間（実務5年） | 健康保険法・厚生年金保険法 |
| マイナンバー | 退職後速やかに廃棄 | マイナンバー法 |
| 標準報酬月額変更履歴 | 5年間 | 労働関係書類と合わせて |
| アクセスログ | 3年間 | 社内規定 |

### 3. 帳票フォーマット
- **PDF**: 法定様式準拠、印刷可能
- **Excel**: 編集可能、データ加工用

### 4. CSV取込み
- エンコーディング: UTF-8（BOM付き）
- エラーハンドリング: バリデーションエラーを一覧表示
- ロールバック: エラー時は全件取込み中止

---

## 📅 実装スケジュール案

### フェーズ1（1-2週間）: 帳票出力機能
- 給与明細書PDF/Excel出力
- 賞与明細書PDF/Excel出力
- 源泉徴収票PDF/Excel出力
- 変更履歴記録機能

### フェーズ2（2-3週間）: マイナンバー管理 + 社労士権限
- マイナンバー暗号化保存
- アクセスログ記録
- マスキング機能
- 社労士権限設定
- 社労士向け帳票出力

### フェーズ3（3-4週間）: 入社ワークフロー
- 4つのフォーム実装
- 承認フロー実装
- 差し戻し機能
- 通知機能
- データ連携

### フェーズ4（1-2週間）: タスク管理
- 入社タスクテンプレート
- 退社タスクテンプレート
- 進捗可視化
- 期限管理

### フェーズ5（1-2週間）: 標準報酬月額・住民税管理
- CSV取込み
- 標準報酬月額自動計算
- 予約設定
- 変更履歴
- eLTAX連携CSV出力

---

## 🔍 追加確認事項

### 確認済み事項
- ✅ 標準報酬月額のCSVフォーマット
- ✅ 予約設定期間（2ヶ月先）
- ✅ 変更履歴保持期間（5年）
- ✅ eLTAX連携CSVフォーマット
- ✅ 特別徴収のみ対応
- ✅ Googleフォーム項目（家族情報、給与振込口座）
- ✅ 承認フロー
- ✅ 労働条件通知書のタイムライン形式記録
- ✅ 電子交付対応希望
- ✅ マイナンバー暗号化レベル
- ✅ アクセスログ記録
- ✅ 社労士の常時アクセス
- ✅ 帳票のPDF/Excel両方出力
- ✅ 電子署名不要（履歴で代替）

### 未確認事項（次回確認）
- ⏳ 労働条件通知書の電子交付方法（既存のMFクラウド契約との連携の可否）
- ⏳ eLTAX CSVファイルの詳細仕様（Excelファイル確認必要）

---

**次のステップ**:
1. ✅ この要件定義書を確認・承認
2. ⏳ 未確認事項の確認（入社案内・通勤経路フォーム、eLTAX仕様）
3. ⏳ フェーズ1の詳細設計開始

**作成者**: Claude Code
**承認者**: （未承認）
