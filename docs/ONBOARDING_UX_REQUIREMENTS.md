# 入社ワークフロー UX要件定義書

**作成日**: 2025-10-17
**最終更新**: 2025-10-17（ユーザーフィードバック反映）
**ステータス**: 要件確定

---

## 📋 ユーザーフィードバックサマリー

### 回答者情報
- **役割**: 人事担当者
- **管理規模**: 月間最大2名の新入社員
- **現在の運用**: Googleフォーム（4種類）+ スプレッドシート

---

## 1️⃣ 新入社員の課題と要望

### 現状の課題

#### A. ナビゲーションの問題
- ❌ **項目が多すぎる**
- ❌ **4つのリンクでどれを対応したか分からなくなる**
- ❌ **必要な資料が手元になくて完了できない**

#### B. 実際の使い方
- ✅ **所要時間**: 10〜15分で完了（家族情報による）
- ✅ **デバイス**: スマホで入力する人もいる（特に通勤経路のファイルアップロード）
- ✅ **入力タイミング**: 数日に分けて対応する方もいる

### 要望と理想

#### ✨ 「これなら簡単！」と思ってもらうには

1. **銀行コードの自動検索**
   - 銀行名を入力すると自動でコードをサジェスト
   - 支店名も同様

2. **入力途中で保存**
   - 中断しても続きから再開可能
   - 自動保存機能

3. **必要資料の事前案内**
   - どのタイミングでどの資料が必要か明示
   - ステップごとに分かりやすく表示
   - 資料を前もって手元に準備できる

---

## 2️⃣ 人事部の課題と要望

### 現状の課題

#### A. 進捗管理の問題
- ❌ **Googleフォームの回答をスプレッドシートで確認** → 非効率
- ❌ **未提出者への催促を手動メール送信** → 手間がかかる
- ❌ **4つのフォームをそれぞれ確認** → 進捗が把握しづらい

#### B. よくあるミス・やり直し

1. **フォームすべてへの回答がない**
   - 一部のフォームだけ未提出

2. **家族情報の漏れ**
   - 扶養にするかしないかの再確認が多い

3. **マイナンバー回収に時間がかかる**
   - 催促が多い
   - 手続きが進まない原因

#### C. 運用情報
- **管理規模**: 月に多くて2人
- **提出期限**: メール送信から3営業日以内
- **催促方法**: メールで手動送信

### 要望と理想

#### ✨ 「進捗が一目でわかる！」と感じるには

1. **ダッシュボードで未提出者がすぐわかる**
   - 4つのフォームの提出状況を一覧表示
   - 未提出フォームを色分けで明示

2. **催促メールの柔軟な自動化**
   - ✅ 自動催促メールは良い機能
   - ⚠️ **BUT**: 時間がかかると事前に言われる場合もある
   - 💡 **解決策**: 全自動送信ではなく、手動トリガー付き自動化
     - 人事担当が確認してから送信ボタンを押す
     - 自動リマインダー（送信前にアラート）
     - 個別にメッセージをカスタマイズ可能

---

## 3️⃣ Googleフォームからの改善ポイント

### 最優先改善項目

#### 1. **重複入力の削減** 🔥 最重要
**現状の問題**:
- 4つの各フォームで同じ情報（名前、メールアドレス、従業員番号など）を何度も入力

**改善案**:
```typescript
// 初回入力（入社案内フォーム）
{
  email: "yamada@example.com",
  lastNameKanji: "山田",
  firstNameKanji: "太郎",
  // ...
}

// 他の3フォームでは自動引用
// ユーザーは編集不要、確認のみ
```

#### 2. **条件分岐で不要な設問を非表示** 🔥 最重要
**現状の問題**:
- すべての設問が表示される
- 回答不要な項目も入力が求められる

**改善例**:

##### 例1: 家族情報フォーム
```
Q: 扶養家族と同居していますか？
A: はい → 住所の設問を非表示（同じ住所なので不要）
A: いいえ → 住所の設問を表示
```

##### 例2: 通勤経路フォーム
```
Q: 通勤方法は？
A: 徒歩 → 交通費・定期代の設問を非表示
A: 公共交通機関 → 交通費・定期代の設問を表示、マイカー関連を非表示
A: マイカー → マイカー関連の設問を表示、交通費関連を非表示
```

##### 例3: 配偶者の有無
```
Q: 配偶者はいますか？
A: いいえ → 配偶者情報の12項目を非表示
A: はい → 配偶者情報を表示
```

#### 3. **間違いやすい設問の回答例**
**特に重要な項目**:
- 税法上の扶養
- 社会保険の扶養
- 同一生計配偶者の判定

**改善案**:
```tsx
// 設問の横にヘルプアイコン
<FormField>
  <Label>
    所得税上の扶養の有無
    <HelpIcon tooltip="配偶者の年間収入が48万円以下の場合「はい」を選択してください" />
  </Label>
  <Select>
    <option>はい</option>
    <option>いいえ</option>
  </Select>

  {/* 選択に応じて説明を表示 */}
  {value === 'はい' && (
    <InfoBox variant="info">
      配偶者控除が適用されます。ただし、納税者（あなた）の前年の合計所得が
      1,000万円以下である必要があります。
    </InfoBox>
  )}
</FormField>
```

#### 4. **必要資料の事前案内**
**改善案**:

##### 入力開始前の案内画面
```
━━━━━━━━━━━━━━━━━━━━━━━
📋 入力前に準備するもの
━━━━━━━━━━━━━━━━━━━━━━━

【全員必須】
✅ 基礎年金番号（年金手帳または基礎年金番号通知書）
✅ 銀行口座情報（通帳またはキャッシュカード）
✅ 通勤経路（Googleマップのスクリーンショット）

【該当者のみ】
📌 前職がある方
  - 雇用保険被保険者番号（離職票または雇用保険被保険者証）
  - 前職の源泉徴収票

📌 家族がいる方
  - 配偶者・家族の生年月日
  - 配偶者・家族の年間収入額

📌 マイカー通勤の方
  - 運転免許証の写真
  - 自賠責保険証の写真
  - 自動車保険証券の写真

[準備できました]ボタン → 入力開始
```

##### ステップごとの資料案内
```tsx
// 各セクションの開始時に表示
<SectionHeader>
  <h3>社会保険・雇用保険</h3>
  <PreparationAlert>
    📋 このセクションで必要なもの:
    - 基礎年金番号（10桁）
    - 雇用保険被保険者番号（11桁、前職がある方のみ）
  </PreparationAlert>
</SectionHeader>
```

---

## 🎨 改善されたUX設計

### 1. 統合ダッシュボード

```
┌─────────────────────────────────────────────────────┐
│ 入社手続き進捗                                        │
├─────────────────────────────────────────────────────┤
│                                                     │
│  提出期限: 2025-10-25（あと5日）                      │
│  提出状況: 2 / 4 フォーム完了                         │
│                                                     │
│  ━━━●━━━●━━━○━━━○━━━                               │
│  基本  口座  通勤  家族                               │
│                                                     │
├─────────────────────────────────────────────────────┤
│                                                     │
│  ✅ 入社案内（基本情報）           【提出済み】       │
│     提出日: 2025-10-18 14:23                         │
│                                                     │
│  ✅ 給与振込口座                   【提出済み】       │
│     提出日: 2025-10-18 14:30                         │
│                                                     │
│  📝 通勤経路申請                   【未提出】         │
│     所要時間: 約10分                                 │
│     📋 準備するもの:                                 │
│        - Googleマップのスクリーンショット            │
│        - マイカー通勤の方: 免許証、保険証の写真       │
│     [入力する]                                      │
│                                                     │
│  📝 家族情報（扶養確認）            【未提出】        │
│     所要時間: 約5〜15分（家族構成による）             │
│     📋 準備するもの:                                 │
│        - 配偶者・家族の生年月日                      │
│        - 配偶者・家族の年間収入額                    │
│     [入力する]                                      │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 2. 人事部ダッシュボード

```
┌───────────────────────────────────────────────────────┐
│ 入社手続き管理                                          │
├───────────────────────────────────────────────────────┤
│ 📊 統計（10月）                                         │
│  ┌────────┬────────┬────────┬────────┐               │
│  │ 対象者 │ 完了   │ 進行中 │ 未開始 │               │
│  │   2    │   1    │   1    │   0    │               │
│  └────────┴────────┴────────┴────────┘               │
├───────────────────────────────────────────────────────┤
│                                                       │
│ 👤 山田太郎                 入社日: 2025-10-20        │
│    期限: あと3日（2025-10-23まで）                     │
│    ━━━●━━━●━━━○━━━○━━━  進捗: 50%                  │
│    ✅ 基本  ✅ 口座  📝 通勤  📝 家族                 │
│    [詳細] [催促メール送信] [期限延長]                 │
│                                                       │
│ 👤 佐藤花子                 入社日: 2025-10-25        │
│    期限: あと8日（2025-10-28まで）                     │
│    ━━━●━━━●━━━●━━━●━━━  進捗: 100%  ✅ 完了        │
│    ✅ 基本  ✅ 口座  ✅ 通勤  ✅ 家族                 │
│    [詳細] [承認処理]                                  │
│                                                       │
└───────────────────────────────────────────────────────┘
```

### 3. スマートフォーム（条件分岐）

#### 例: 家族情報フォーム

```tsx
// 配偶者の有無で表示を切り替え
<FormSection>
  <RadioGroup name="hasSpouse">
    <Radio value="yes">配偶者あり</Radio>
    <Radio value="no">配偶者なし</Radio>
  </RadioGroup>

  {/* 「配偶者あり」を選択した場合のみ表示 */}
  {hasSpouse === 'yes' && (
    <>
      <Input name="spouseName" label="配偶者氏名" />
      <Input name="spouseBirthDate" label="生年月日" />

      <RadioGroup name="liveTogether">
        <Radio value="yes">同居している</Radio>
        <Radio value="no">別居している</Radio>
      </RadioGroup>

      {/* 別居の場合のみ住所を表示 */}
      {liveTogether === 'no' && (
        <Input name="spouseAddress" label="配偶者の住所" />
      )}

      {/* 収入に応じて自動判定＆説明表示 */}
      <Input
        name="spouseAnnualIncome"
        label="配偶者の年間収入"
        type="number"
        onChange={(value) => {
          // リアルタイムで判定
          if (value <= 480000) {
            showInfo("配偶者控除が適用できます");
          } else if (value < 1300000) {
            showInfo("配偶者特別控除が適用できます");
          } else {
            showWarning("配偶者控除・特別控除は適用されません");
          }
        }}
      />
    </>
  )}
</FormSection>
```

### 4. 催促メールの柔軟な管理

```tsx
// 人事ダッシュボード上のコントロール
<ActionPanel>
  {/* 自動リマインダー設定 */}
  <AutoReminderSetting>
    <Switch
      label="自動リマインダー"
      defaultChecked={true}
    />
    <Select label="タイミング">
      <option>期限1日前</option>
      <option>期限2日前</option>
      <option>期限3日前</option>
    </Select>
    <Textarea
      label="メッセージテンプレート"
      placeholder="入社手続きの期限が近づいています..."
      editable
    />
  </AutoReminderSetting>

  {/* 手動催促ボタン */}
  <Button
    variant="secondary"
    onClick={() => {
      // プレビュー表示
      showEmailPreview({
        to: employee.email,
        subject: "【リマインド】入社手続きのお願い",
        body: customMessage,
      });
      // 確認後に送信
    }}
  >
    📧 催促メール送信
  </Button>

  {/* 期限延長ボタン */}
  <Button
    variant="outline"
    onClick={() => {
      showExtensionDialog({
        currentDeadline: "2025-10-23",
        employee: employee,
      });
    }}
  >
    📅 期限延長
  </Button>
</ActionPanel>
```

---

## 🚀 優先実装項目（フィードバック反映版）

### Phase 1: 基盤機能（2週間）
1. ✅ **統合ダッシュボード**
   - 4フォームの進捗可視化
   - チェックリスト形式

2. ✅ **重複入力の削減**
   - 初回入力の自動引用
   - 基本情報（名前、メール等）の共通化

3. ✅ **自動保存機能**
   - 30秒ごとの自動保存
   - 離脱時の保存確認

### Phase 2: スマートフォーム（3週間）
1. ✅ **条件分岐UI**
   - 配偶者の有無 → 配偶者情報の表示/非表示
   - 同居/別居 → 住所の表示/非表示
   - 通勤方法 → 必要項目の切り替え

2. ✅ **入力支援**
   - 銀行コードの自動検索・サジェスト
   - 郵便番号から住所自動入力
   - リアルタイムバリデーション

3. ✅ **必要資料の事前案内**
   - 入力開始前の案内画面
   - ステップごとの資料チェックリスト
   - 不足資料のアラート

### Phase 3: 人事管理機能（2週間）
1. ✅ **進捗管理ダッシュボード**
   - 未提出者の一覧表示
   - フィルター・検索機能
   - 4フォームの個別ステータス表示

2. ✅ **柔軟な催促機能**
   - 手動トリガー付き催促メール
   - メッセージのカスタマイズ
   - 自動リマインダー（オプション）

3. ✅ **期限管理**
   - 提出期限の設定（デフォルト: 3営業日）
   - 期限延長機能
   - 期限アラート

### Phase 4: モバイル最適化（1週間）
1. ✅ **スマホ対応**
   - レスポンシブデザイン
   - ファイルアップロード（カメラ直接撮影対応）
   - タッチ操作の最適化

### Phase 5: ヘルプ・ガイド（1週間）
1. ✅ **間違いやすい設問の回答例**
   - インラインヘルプ
   - ツールチップ
   - 自動判定＆説明表示

2. ✅ **マイナンバー回収の促進**
   - 重要性の説明
   - 提出方法のガイド
   - 催促の優先順位付け

**総期間: 9週間（約2ヶ月）** → **変更なし**

---

## 📊 想定される改善効果

### 新入社員側
- ✅ **重複入力削減**: 4回 → 1回（名前などの基本情報）
- ✅ **不要な設問を非表示**: 項目数が20〜30%削減
- ✅ **必要資料が明確**: 準備不足による中断が減少
- ✅ **進捗が一目瞭然**: 「どれを対応したか分からない」問題を解消

### 人事部側
- ✅ **進捗確認の効率化**: スプレッドシート確認 → ダッシュボード一覧
- ✅ **催促の自動化**: 手動メール → ボタン1つで送信
- ✅ **未提出者の把握**: 即座に確認可能
- ✅ **よくあるミスの削減**:
  - 条件分岐で不要な設問を非表示 → 入力漏れ減少
  - リアルタイムヘルプ → 扶養の判断ミス減少

---

## 🔍 追加確認事項（確定）

### マイナンバー回収について ✅ 確定
- ✅ **現在の方法**: チャットワークのDM
- ✅ **システム統合**: 必要（入社ワークフローに統合）
- ✅ **セキュリティ要件**: 強固に（256bit暗号化、アクセス制限、監査ログ）

**実装方針**:
```typescript
// マイナンバー項目を入社案内フォームに含める
interface BasicInfoForm {
  // ... 他の項目
  myNumber?: string;              // マイナンバー（12桁）
  myNumberSubmitted: boolean;     // 提出状況
  myNumberRequestedAt?: string;   // 催促日時
}

// セキュリティ対策（Phase 2で本格実装）
// - 入力時に暗号化
// - 保存時にAES-256暗号化
// - 表示時にマスキング（****-****-1234）
// - アクセスログ記録
// - 人事部・社労士のみ閲覧可能
```

### 通知について ✅ 確定
- ✅ **メール通知**: システムが自動生成（テンプレート設計）
- ✅ **チャット連携**: チャットワーク API連携（Slackではなく）

**実装方針**:
```typescript
// チャットワーク連携
interface NotificationService {
  // メール送信
  sendEmail(to: string, subject: string, body: string): Promise<void>;

  // チャットワーク DM送信
  sendChatworkDM(userId: string, message: string): Promise<void>;

  // 統合通知（メール + チャットワーク）
  sendNotification(
    employee: Employee,
    type: 'reminder' | 'approval' | 'return' | 'myNumberRequest',
    customMessage?: string
  ): Promise<void>;
}
```

### その他
- ⏳ 多言語対応（英語、中国語等）の優先度は？ → 後回し（Phase 6以降）

---

## 📧 通知テンプレート設計

### 1. 入社手続き開始通知
```
件名: 【重要】入社手続きのご案内

山田太郎 様

お世話になっております。
入社日（2025年10月20日）に向けて、以下の手続きをお願いいたします。

━━━━━━━━━━━━━━━━━━━━━━
📋 提出期限: 2025年10月23日（3営業日以内）
━━━━━━━━━━━━━━━━━━━━━━

以下のリンクから入力をお願いいたします：
https://dandori-portal.com/onboarding/xxxxx

【入力が必要な項目】
✅ 入社案内（基本情報）
✅ 給与振込口座
✅ 通勤経路申請
✅ 家族情報（扶養確認）

【事前に準備するもの】
- 基礎年金番号（年金手帳）
- 銀行口座情報（通帳・キャッシュカード）
- 通勤経路（Googleマップのスクリーンショット）
- 家族の生年月日・収入情報（該当者のみ）
- マイカー通勤の方: 運転免許証、保険証の写真

入力途中で保存できますので、お時間のある時にご対応ください。

ご不明点がございましたら、人事部までお問い合わせください。
```

### 2. リマインダー通知（期限1日前）
```
件名: 【リマインド】入社手続きの期限が明日です

山田太郎 様

入社手続きの提出期限が明日（2025年10月23日）となっております。

現在の進捗: 2 / 4 フォーム完了
✅ 入社案内
✅ 給与振込口座
📝 通勤経路申請 ← 未提出
📝 家族情報 ← 未提出

以下のリンクから続きをご入力ください：
https://dandori-portal.com/onboarding/xxxxx

※期限に間に合わない場合は、人事部までご連絡ください。
```

### 3. マイナンバー提出依頼
```
件名: 【重要】マイナンバーの提出をお願いいたします

山田太郎 様

社会保険・雇用保険の加入手続きに必要なため、
マイナンバー（個人番号）の提出をお願いいたします。

【提出方法】
以下のリンクから安全に提出いただけます：
https://dandori-portal.com/onboarding/xxxxx/my-number

※当システムは256bit暗号化通信で保護されております。
※マイナンバーは法令に基づき厳格に管理いたします。

【マイナンバーの確認方法】
- マイナンバーカード
- 通知カード
- マイナンバーが記載された住民票

ご協力のほど、よろしくお願いいたします。
```

### 4. チャットワークメッセージ（催促用）
```
[info][title]入社手続きのリマインド[/title]
山田太郎さん

入社手続きの提出期限が近づいています。
進捗: 2 / 4 完了

未提出のフォーム:
・通勤経路申請
・家族情報

以下からご対応ください：
https://dandori-portal.com/onboarding/xxxxx

期限に間に合わない場合はご連絡ください。[/info]
```

---

## 🔐 セキュリティ仕様（マイナンバー管理）

### 暗号化仕様
```typescript
// AES-256-GCM暗号化
interface MyNumberEncryption {
  algorithm: 'AES-256-GCM';
  keyLength: 256;
  ivLength: 12;
  tagLength: 16;
}

// マイナンバー暗号化処理
class MyNumberService {
  // 暗号化
  async encrypt(myNumber: string): Promise<EncryptedData> {
    const key = await this.getEncryptionKey();
    const iv = crypto.randomBytes(12);
    const cipher = crypto.createCipheriv('aes-256-gcm', key, iv);

    const encrypted = Buffer.concat([
      cipher.update(myNumber, 'utf8'),
      cipher.final()
    ]);

    const tag = cipher.getAuthTag();

    return {
      encrypted: encrypted.toString('base64'),
      iv: iv.toString('base64'),
      tag: tag.toString('base64')
    };
  }

  // 復号化
  async decrypt(data: EncryptedData): Promise<string> {
    const key = await this.getEncryptionKey();
    const decipher = crypto.createDecipheriv(
      'aes-256-gcm',
      key,
      Buffer.from(data.iv, 'base64')
    );

    decipher.setAuthTag(Buffer.from(data.tag, 'base64'));

    const decrypted = Buffer.concat([
      decipher.update(Buffer.from(data.encrypted, 'base64')),
      decipher.final()
    ]);

    return decrypted.toString('utf8');
  }

  // マスキング表示
  mask(myNumber: string): string {
    // 例: 123456789012 → ****-****-9012
    return `****-****-${myNumber.slice(-4)}`;
  }
}
```

### アクセス制御
```typescript
// マイナンバーへのアクセス権限
enum MyNumberPermission {
  NONE = 0,        // アクセス不可
  VIEW_MASKED = 1, // マスキング表示のみ
  VIEW_FULL = 2,   // 完全表示
  EDIT = 3,        // 編集可能
}

// 役割ごとの権限
const MY_NUMBER_ACCESS_CONTROL = {
  employee: MyNumberPermission.VIEW_MASKED,      // 本人: マスキング表示
  hr: MyNumberPermission.VIEW_FULL,              // 人事: 完全表示
  socialInsuranceConsultant: MyNumberPermission.VIEW_FULL, // 社労士: 完全表示
  manager: MyNumberPermission.NONE,              // 管理職: アクセス不可
  admin: MyNumberPermission.EDIT,                // システム管理者: 編集可能
};
```

### 監査ログ
```typescript
// マイナンバーアクセスログ
interface MyNumberAuditLog {
  id: string;
  employeeId: string;          // 対象従業員
  accessedBy: string;           // アクセス者
  accessType: 'view' | 'edit' | 'export'; // アクセス種別
  accessedAt: string;           // アクセス日時
  ipAddress: string;            // IPアドレス
  userAgent: string;            // ブラウザ情報
  purpose?: string;             // アクセス目的（任意入力）
}

// ログ記録
async function logMyNumberAccess(log: MyNumberAuditLog) {
  await auditLogStore.add({
    category: 'my_number_access',
    severity: 'high',
    ...log
  });
}
```

---

## 🚀 実装優先順位（最終版）

### Phase 1: 基盤機能（2週間）
1. ✅ 統合ダッシュボード
2. ✅ 重複入力の削減
3. ✅ 自動保存機能
4. ✅ マイナンバー項目追加（暗号化は簡易版）

### Phase 2: スマートフォーム（3週間）
1. ✅ 条件分岐UI
2. ✅ 入力支援（銀行コード、住所自動入力）
3. ✅ 必要資料の事前案内
4. ✅ リアルタイムバリデーション

### Phase 3: 人事管理機能（2週間）
1. ✅ 進捗管理ダッシュボード
2. ✅ 柔軟な催促機能
3. ✅ 期限管理
4. ✅ メール・チャットワーク通知

### Phase 4: モバイル最適化（1週間）
1. ✅ スマホ対応
2. ✅ ファイルアップロード（カメラ対応）

### Phase 5: ヘルプ・ガイド（1週間）
1. ✅ 間違いやすい設問の回答例
2. ✅ マイナンバー提出促進

### Phase 6: セキュリティ強化（フェーズ2と統合）
1. ✅ マイナンバー本格暗号化（AES-256-GCM）
2. ✅ アクセス制御
3. ✅ 監査ログ
4. ✅ 社労士権限実装

---

**次のステップ**: この確定要件を基に、Phase 1の実装を開始します。
