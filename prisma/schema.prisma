generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model achievements {
  id                String            @id
  tenantId          String
  profileId         String
  userId            String
  title             String
  description       String?
  date              DateTime          @db.Date
  category          String?
  attachments       Json?
  isPublic          Boolean           @default(true)
  createdAt         DateTime          @default(now())
  updatedAt         DateTime
  employee_profiles employee_profiles @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
  @@index([tenantId, category])
  @@index([tenantId])
  @@index([userId])
}

model activity_feeds {
  id           String   @id
  tenantId     String
  activityType String
  title        String
  description  String?
  icon         String?
  userId       String?
  userName     String?
  resourceType String?
  resourceId   String?
  priority     String   @default("normal")
  isPublic     Boolean  @default(true)
  targetRoles  String[]
  createdAt    DateTime @default(now())

  @@index([tenantId, activityType])
  @@index([tenantId, createdAt])
  @@index([tenantId])
  @@index([tenantId, userId])
}

model announcement_reads {
  id                String        @id
  tenantId          String
  announcementId    String
  userId            String
  readAt            DateTime      @default(now())
  actionCompleted   Boolean       @default(false)
  actionCompletedAt DateTime?
  announcements     announcements @relation(fields: [announcementId], references: [id], onDelete: Cascade)

  @@unique([announcementId, userId])
  @@index([announcementId])
  @@index([tenantId])
  @@index([tenantId, userId])
  @@index([userId])
}

model announcements {
  id                 String               @id
  tenantId           String
  title              String
  content            String
  type               String               @default("general")
  priority           String               @default("normal")
  target             String               @default("all")
  targetDepartments  String[]
  targetRoles        String[]
  published          Boolean              @default(false)
  publishedAt        DateTime?
  startDate          DateTime             @db.Date
  endDate            DateTime?            @db.Date
  requiresAction     Boolean              @default(false)
  actionLabel        String?
  actionUrl          String?
  actionDeadline     DateTime?            @db.Date
  createdBy          String
  createdByName      String?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  announcement_reads announcement_reads[]

  @@index([published, startDate, endDate])
  @@index([tenantId])
  @@index([tenantId, published])
  @@index([tenantId, startDate])
}

model approval_flow_approvers {
  id                  String              @id
  stepId              String
  approverType        String
  approverId          String?
  approverRole        String?
  positionLevel       Int?
  order               Int                 @default(1)
  createdAt           DateTime            @default(now())
  updatedAt           DateTime
  approval_flow_steps approval_flow_steps @relation(fields: [stepId], references: [id], onDelete: Cascade)

  @@index([stepId])
}

model approval_flow_conditions {
  id                        String                    @id
  flowId                    String
  field                     String
  operator                  String
  value                     Float
  description               String?
  createdAt                 DateTime                  @default(now())
  updatedAt                 DateTime
  approval_flow_definitions approval_flow_definitions @relation(fields: [flowId], references: [id], onDelete: Cascade)

  @@index([flowId])
}

model approval_flow_definitions {
  id                       String                     @id
  tenantId                 String
  name                     String
  description              String?
  documentType             String
  flowType                 String
  useOrganizationHierarchy Boolean                    @default(false)
  organizationLevels       Int?
  isActive                 Boolean                    @default(true)
  isDefault                Boolean                    @default(false)
  priority                 Int                        @default(1)
  createdBy                String
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime
  approval_flow_conditions approval_flow_conditions[]
  approval_flow_steps      approval_flow_steps[]

  @@index([tenantId, documentType])
  @@index([tenantId, documentType, isActive])
  @@index([tenantId])
}

model approval_flow_steps {
  id                        String                    @id
  flowId                    String
  stepNumber                Int
  name                      String
  executionMode             String                    @default("serial")
  requiredApprovals         Int                       @default(1)
  timeoutHours              Int?
  allowDelegate             Boolean                   @default(true)
  allowSkip                 Boolean                   @default(false)
  createdAt                 DateTime                  @default(now())
  updatedAt                 DateTime
  approval_flow_approvers   approval_flow_approvers[]
  approval_flow_definitions approval_flow_definitions @relation(fields: [flowId], references: [id], onDelete: Cascade)

  @@index([flowId])
  @@index([flowId, stepNumber])
}

model approval_steps {
  id                String            @id
  tenantId          String
  workflowId        String
  order             Int
  approverRole      String
  approverId        String?
  approverName      String?
  status            String            @default("pending")
  actionDate        DateTime?
  comments          String?
  executionMode     String            @default("sequential")
  timeoutHours      Int?
  isEscalated       Boolean           @default(false)
  escalatedTo       String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime
  workflow_requests workflow_requests @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  @@index([approverId])
  @@index([status])
  @@index([tenantId, approverId])
  @@index([tenantId])
  @@index([tenantId, status])
  @@index([workflowId])
}

model attendance {
  id                String    @id
  tenantId          String
  userId            String
  date              DateTime  @db.Date
  checkIn           DateTime?
  checkOut          DateTime?
  breakStart        DateTime?
  breakEnd          DateTime?
  totalBreakMinutes Int       @default(0)
  workMinutes       Int       @default(0)
  overtimeMinutes   Int       @default(0)
  workLocation      String    @default("office")
  status            String    @default("present")
  memo              String?
  approvalStatus    String?
  approvalReason    String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime
  checkInLocation   Json?
  checkOutLocation  Json?
  tenants           tenants   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  users             users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, date])
  @@index([date])
  @@index([status])
  @@index([tenantId, date])
  @@index([tenantId])
  @@index([tenantId, userId])
  @@index([userId])
}

model attendance_settings {
  id                       String   @id
  tenantId                 String   @unique
  workStartTime            String   @default("09:00")
  workEndTime              String   @default("18:00")
  breakStartTime           String   @default("12:00")
  breakEndTime             String   @default("13:00")
  breakDurationMinutes     Int      @default(60)
  enableFlexTime           Boolean  @default(false)
  coreTimeStart            String?
  coreTimeEnd              String?
  overtimeThresholdMinutes Int      @default(480)
  maxOvertimeHoursPerMonth Int      @default(45)
  allowRemoteCheckIn       Boolean  @default(true)
  requireLocationOnCheckIn Boolean  @default(false)
  allowEarlyCheckIn        Boolean  @default(true)
  earlyCheckInMinutes      Int      @default(30)
  weeklyHolidays           String[] @default(["saturday", "sunday"])
  createdAt                DateTime @default(now())
  updatedAt                DateTime

  @@index([tenantId])
}

model certification_notification_settings {
  id                      String   @id
  tenantId                String   @unique
  notificationDays        Int[]    @default([90, 60, 30, 14, 7])
  enableEmailNotification Boolean  @default(true)
  enablePushNotification  Boolean  @default(true)
  enableInAppNotification Boolean  @default(true)
  escalateToManagerDays   Int      @default(30)
  escalateToHrDays        Int      @default(14)
  autoUpdateStatus        Boolean  @default(true)
  warningThresholdDays    Int      @default(30)
  createdAt               DateTime @default(now())
  updatedAt               DateTime
}

model certification_notifications {
  id                 String         @id
  tenantId           String
  certificationId    String
  userId             String
  notificationType   String
  daysUntilExpiry    Int
  sentAt             DateTime?
  readAt             DateTime?
  acknowledgedAt     DateTime?
  emailSent          Boolean        @default(false)
  pushSent           Boolean        @default(false)
  inAppSent          Boolean        @default(false)
  escalatedToManager Boolean        @default(false)
  escalatedToHr      Boolean        @default(false)
  managerNotifiedAt  DateTime?
  hrNotifiedAt       DateTime?
  createdAt          DateTime       @default(now())
  certifications     certifications @relation(fields: [certificationId], references: [id], onDelete: Cascade)

  @@index([certificationId])
  @@index([sentAt])
  @@index([tenantId])
  @@index([tenantId, notificationType])
  @@index([tenantId, userId])
  @@index([userId])
}

model certification_renewals {
  id                   String         @id
  tenantId             String
  certificationId      String
  userId               String
  newIssueDate         DateTime       @db.Date
  newExpiryDate        DateTime?      @db.Date
  newCredentialId      String?
  newDocumentUrl       String?
  newDocumentName      String?
  notes                String?
  status               String         @default("pending")
  reviewedBy           String?
  reviewedByName       String?
  reviewedAt           DateTime?
  reviewComment        String?
  documentVerified     Boolean        @default(false)
  dateVerified         Boolean        @default(false)
  organizationVerified Boolean        @default(false)
  createdAt            DateTime       @default(now())
  updatedAt            DateTime
  certifications       certifications @relation(fields: [certificationId], references: [id], onDelete: Cascade)

  @@index([certificationId])
  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, userId, status])
  @@index([userId])
}

model certifications {
  id                          String                        @id
  tenantId                    String
  profileId                   String
  userId                      String
  name                        String
  organization                String
  issueDate                   DateTime                      @db.Date
  expiryDate                  DateTime?                     @db.Date
  credentialId                String?
  status                      String                        @default("active")
  documentUrl                 String?
  documentName                String?
  documentSize                String?
  notes                       String?
  createdAt                   DateTime                      @default(now())
  updatedAt                   DateTime
  certification_notifications certification_notifications[]
  certification_renewals      certification_renewals[]
  employee_profiles           employee_profiles             @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
  @@index([tenantId, expiryDate])
  @@index([tenantId])
  @@index([tenantId, status])
  @@index([userId])
}

model company_settings {
  id                  String    @id
  tenantId            String    @unique
  name                String
  nameKana            String?
  postalCode          String?
  address             String?
  phone               String?
  fax                 String?
  email               String?
  corporateNumber     String?
  representativeName  String?
  representativeTitle String?
  taxOffice           String?
  taxOfficeCode       String?
  fiscalYearEnd       String?
  foundedDate         DateTime? @db.Date
  createdAt           DateTime  @default(now())
  updatedAt           DateTime

  @@index([tenantId])
}

model daily_attendance_metrics {
  id                   String   @id
  tenantId             String
  date                 DateTime @db.Date
  totalEmployees       Int      @default(0)
  presentCount         Int      @default(0)
  absentCount          Int      @default(0)
  leaveCount           Int      @default(0)
  lateCount            Int      @default(0)
  earlyLeaveCount      Int      @default(0)
  remoteCount          Int      @default(0)
  totalWorkMinutes     Int      @default(0)
  totalOvertimeMinutes Int      @default(0)
  avgWorkMinutes       Int      @default(0)
  attendanceRate       Float    @default(0)
  calculatedAt         DateTime @default(now())
  createdAt            DateTime @default(now())
  updatedAt            DateTime

  @@unique([tenantId, date])
  @@index([tenantId, date])
  @@index([tenantId])
}

model departments {
  id        String   @id
  tenantId  String
  name      String
  parentId  String?
  sortOrder Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime

  @@unique([tenantId, name])
  @@index([tenantId])
  @@index([tenantId, isActive])
  @@index([tenantId, sortOrder])
}

model dw_notifications {
  id          String    @id
  type        String
  title       String
  description String?
  priority    String    @default("normal")
  tenantId    String?
  tenantName  String?
  invoiceId   String?
  amount      Int?
  isRead      Boolean   @default(false)
  readAt      DateTime?
  readBy      String?
  actionUrl   String?
  actionLabel String?
  createdAt   DateTime  @default(now())

  @@index([createdAt])
  @@index([isRead])
  @@index([tenantId])
  @@index([type])
}

model employee_change_requests {
  id             String    @id
  tenantId       String
  userId         String
  requestType    String
  fieldName      String?
  currentValue   String?
  newValue       String
  reason         String?
  attachments    Json?
  status         String    @default("pending")
  reviewedBy     String?
  reviewedByName String?
  reviewedAt     DateTime?
  reviewComment  String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime

  @@index([tenantId])
  @@index([tenantId, requestType])
  @@index([tenantId, status])
  @@index([userId])
}

model employee_profiles {
  id                       String             @id
  tenantId                 String
  userId                   String             @unique
  employeeNumber           String?
  nameKana                 String?
  birthDate                DateTime?          @db.Date
  gender                   String?
  phone                    String?
  mobilePhone              String?
  postalCode               String?
  address                  String?
  addressKana              String?
  emergencyContactName     String?
  emergencyContactRelation String?
  emergencyContactPhone    String?
  bankName                 String?
  bankBranch               String?
  bankAccountType          String?
  bankAccountNumber        String?
  bankAccountHolder        String?
  commuteMethod            String?
  commuteRoute             String?
  commuteDistance          Float?
  commuteCost              Int?
  employmentType           String?
  contractEndDate          DateTime?          @db.Date
  completedProjectsCount   Int                @default(0)
  teamMembersCount         Int                @default(0)
  yearsOfExperience        Int                @default(0)
  createdAt                DateTime           @default(now())
  updatedAt                DateTime
  achievements             achievements[]
  certifications           certifications[]
  employee_skills          employee_skills[]
  work_experiences         work_experiences[]

  @@index([tenantId, employeeNumber])
  @@index([tenantId])
  @@index([userId])
}

model employee_skills {
  id                String            @id
  tenantId          String
  profileId         String
  userId            String
  name              String
  category          String
  level             Int               @default(50)
  selfAssessment    Int?
  managerAssessment Int?
  assessedAt        DateTime?
  notes             String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime
  employee_profiles employee_profiles @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@unique([profileId, name])
  @@index([profileId])
  @@index([tenantId, category])
  @@index([tenantId])
  @@index([userId])
}

model employment_types {
  id        String   @id
  tenantId  String
  name      String
  sortOrder Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime

  @@unique([tenantId, name])
  @@index([tenantId])
  @@index([tenantId, isActive])
}

model general_assets {
  id                 String           @id
  tenantId           String
  assetNumber        String
  category           String
  name               String
  manufacturer       String?
  model              String?
  serialNumber       String?
  specifications     Json?
  assignedUserId     String?
  assignedUserName   String?
  assignedDate       DateTime?        @db.Date
  ownershipType      String           @default("owned")
  purchaseDate       DateTime?        @db.Date
  purchaseCost       Int?
  leaseCompany       String?
  leaseMonthlyCost   Int?
  leaseStartDate     DateTime?        @db.Date
  leaseEndDate       DateTime?        @db.Date
  warrantyExpiration DateTime?        @db.Date
  status             String           @default("active")
  notes              String?
  createdAt          DateTime         @default(now())
  updatedAt          DateTime
  repair_records     repair_records[]

  @@unique([tenantId, assetNumber])
  @@index([tenantId, assignedUserId])
  @@index([tenantId, category])
  @@index([tenantId])
  @@index([tenantId, status])
}

model health_access_logs {
  id           String   @id
  tenantId     String
  userId       String
  targetUserId String
  resourceType String
  resourceId   String?
  action       String
  ipAddress    String?
  userAgent    String?
  createdAt    DateTime @default(now())

  @@index([targetUserId])
  @@index([tenantId, createdAt])
  @@index([tenantId])
  @@index([userId])
}

model health_checkup_summaries {
  id                     String   @id
  tenantId               String
  fiscalYear             Int
  month                  Int
  totalEmployees         Int      @default(0)
  completedCount         Int      @default(0)
  pendingCount           Int      @default(0)
  completionRate         Float    @default(0)
  resultACount           Int      @default(0)
  resultBCount           Int      @default(0)
  resultCCount           Int      @default(0)
  resultDCount           Int      @default(0)
  resultECount           Int      @default(0)
  requiresReexamCount    Int      @default(0)
  requiresTreatmentCount Int      @default(0)
  requiresGuidanceCount  Int      @default(0)
  calculatedAt           DateTime @default(now())
  createdAt              DateTime @default(now())
  updatedAt              DateTime

  @@unique([tenantId, fiscalYear, month])
  @@index([tenantId, fiscalYear])
  @@index([tenantId])
}

model health_checkups {
  id                     String            @id
  tenantId               String
  userId                 String
  userName               String
  checkupDate            DateTime          @db.Date
  checkupType            String
  medicalInstitution     String?
  fiscalYear             Int
  overallResult          String
  requiresReexam         Boolean           @default(false)
  requiresTreatment      Boolean           @default(false)
  requiresGuidance       Boolean           @default(false)
  height                 Float?
  weight                 Float?
  bmi                    Float?
  waistCircumference     Float?
  eyesightLeft           Float?
  eyesightRight          Float?
  hearingLeft            String?
  hearingRight           String?
  bloodPressureSystolic  Int?
  bloodPressureDiastolic Int?
  bloodGlucose           Float?
  hba1c                  Float?
  triglycerides          Float?
  hdlCholesterol         Float?
  ldlCholesterol         Float?
  got                    Float?
  gpt                    Float?
  gammaGtp               Float?
  uricAcid               Float?
  urinaryProtein         String?
  urinaryGlucose         String?
  followUpStatus         String            @default("none")
  followUpDate           DateTime?         @db.Date
  followUpNotes          String?
  doctorOpinion          String?
  workRestriction        String?
  attachments            Json?
  createdAt              DateTime          @default(now())
  updatedAt              DateTime
  health_findings        health_findings[]

  @@index([tenantId, checkupDate])
  @@index([tenantId, fiscalYear])
  @@index([tenantId])
  @@index([tenantId, userId])
  @@index([userId])
}

model health_findings {
  id              String          @id
  checkupId       String
  category        String
  finding         String
  severity        String
  recommendation  String?
  createdAt       DateTime        @default(now())
  health_checkups health_checkups @relation(fields: [checkupId], references: [id], onDelete: Cascade)

  @@index([checkupId])
}

model health_settings {
  id                        String   @id
  tenantId                  String   @unique
  checkupPeriodStart        Int      @default(4)
  checkupPeriodEnd          Int      @default(3)
  checkupReminderDays       Int      @default(30)
  requireCheckupForNewHires Boolean  @default(true)
  stressCheckPeriodStart    Int      @default(10)
  stressCheckPeriodEnd      Int      @default(11)
  stressCheckReminderDays   Int      @default(14)
  stressCheckRequired       Boolean  @default(true)
  highStressThresholdA      Int      @default(77)
  highStressThresholdB      Int      @default(63)
  allowSelfView             Boolean  @default(true)
  allowManagerViewStatus    Boolean  @default(true)
  allowHrViewStats          Boolean  @default(true)
  createdAt                 DateTime @default(now())
  updatedAt                 DateTime
}

model invoice_items {
  id          String   @id
  invoiceId   String
  description String
  quantity    Int
  unitPrice   Int
  amount      Int
  period      String?
  invoices    invoices @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId])
}

model invoice_reminders {
  id            String    @id
  tenantId      String
  invoiceId     String
  reminderType  String
  scheduledDate DateTime  @db.Date
  daysBeforeDue Int
  status        String    @default("scheduled")
  sentAt        DateTime?
  sentTo        String?
  errorMessage  String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime
  invoices      invoices  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId])
  @@index([scheduledDate])
  @@index([status])
  @@index([tenantId])
}

model invoices {
  id                String              @id
  invoiceNumber     String              @unique
  tenantId          String
  billingMonth      DateTime            @db.Date
  subtotal          Int
  tax               Int
  total             Int
  status            String              @default("draft")
  dueDate           DateTime            @db.Date
  paidDate          DateTime?           @db.Date
  sentDate          DateTime?
  billingEmail      String
  memo              String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  invoice_items     invoice_items[]
  invoice_reminders invoice_reminders[]
  tenants           tenants             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  payments          payments[]

  @@index([billingMonth])
  @@index([invoiceNumber])
  @@index([status])
  @@index([tenantId, billingMonth])
  @@index([tenantId])
  @@index([tenantId, status])
}

model leave_balances {
  id                         String   @id
  tenantId                   String
  userId                     String
  year                       Int
  paidLeaveTotal             Int      @default(0)
  paidLeaveUsed              Float    @default(0)
  paidLeaveRemaining         Float    @default(0)
  paidLeaveExpiry            DateTime @db.Date
  sickLeaveTotal             Int      @default(0)
  sickLeaveUsed              Float    @default(0)
  sickLeaveRemaining         Float    @default(0)
  specialLeaveTotal          Int      @default(0)
  specialLeaveUsed           Float    @default(0)
  specialLeaveRemaining      Float    @default(0)
  compensatoryLeaveTotal     Int      @default(0)
  compensatoryLeaveUsed      Float    @default(0)
  compensatoryLeaveRemaining Float    @default(0)
  createdAt                  DateTime @default(now())
  updatedAt                  DateTime

  @@unique([userId, year])
  @@index([tenantId])
  @@index([tenantId, userId])
  @@index([userId])
}

model leave_requests {
  id             String    @id
  tenantId       String
  userId         String
  userName       String
  type           String
  startDate      DateTime  @db.Date
  endDate        DateTime  @db.Date
  days           Float
  reason         String
  attachments    Json?
  status         String    @default("draft")
  approver       String?
  approverName   String?
  approvedDate   DateTime?
  rejectedReason String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime

  @@index([endDate])
  @@index([startDate])
  @@index([status])
  @@index([tenantId])
  @@index([tenantId, startDate])
  @@index([tenantId, status])
  @@index([tenantId, userId])
  @@index([userId])
}

model legal_updates {
  id                    String                  @id
  title                 String
  description           String?
  category              String
  effectiveDate         DateTime                @db.Date
  relatedLaws           String?
  affectedAreas         String[]
  priority              String                  @default("medium")
  isPublished           Boolean                 @default(false)
  publishedAt           DateTime?
  referenceUrl          String?
  attachments           Json?
  createdBy             String?
  createdAt             DateTime                @default(now())
  updatedAt             DateTime
  tenant_legal_statuses tenant_legal_statuses[]

  @@index([category])
  @@index([effectiveDate])
  @@index([isPublished, effectiveDate])
  @@index([isPublished])
  @@index([priority])
}

model maintenance_records {
  id              String    @id
  tenantId        String
  vehicleId       String
  type            String
  date            DateTime  @db.Date
  mileage         Int?
  cost            Int
  vendorId        String?
  description     String?
  nextDueDate     DateTime? @db.Date
  nextDueMileage  Int?
  tireType        String?
  performedBy     String?
  performedByName String?
  notes           String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime
  vehicles        vehicles  @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  vendors         vendors?  @relation(fields: [vendorId], references: [id])

  @@index([tenantId])
  @@index([tenantId, type])
  @@index([tenantId, vehicleId])
  @@index([vehicleId])
}

model monthly_mileages {
  id             String   @id
  tenantId       String
  vehicleId      String
  month          String
  distance       Int
  recordedBy     String?
  recordedByName String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime
  vehicles       vehicles @relation(fields: [vehicleId], references: [id], onDelete: Cascade)

  @@unique([vehicleId, month])
  @@index([tenantId])
  @@index([vehicleId])
}

model org_units {
  id              String      @id
  tenantId        String
  name            String
  parentId        String?
  level           Int         @default(0)
  headUserId      String?
  type            String
  memberCount     Int         @default(0)
  description     String?
  isActive        Boolean     @default(true)
  createdAt       DateTime    @default(now())
  updatedAt       DateTime
  org_units       org_units?  @relation("org_unitsToorg_units", fields: [parentId], references: [id])
  other_org_units org_units[] @relation("org_unitsToorg_units")
  tenants         tenants     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  users           users[]

  @@index([parentId])
  @@index([tenantId])
  @@index([tenantId, isActive])
  @@index([tenantId, parentId])
}

model payments {
  id              String    @id
  tenantId        String
  invoiceId       String
  amount          Int
  paymentDate     DateTime  @db.Date
  paymentMethod   String    @default("bank_transfer")
  status          String    @default("completed")
  transactionId   String?
  notes           String?
  confirmedBy     String?
  confirmedByName String?
  confirmedAt     DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime
  invoices        invoices  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId])
  @@index([tenantId])
  @@index([tenantId, paymentDate])
  @@index([tenantId, status])
}

model payroll_settings {
  id                        String   @id
  tenantId                  String   @unique
  paymentDay                Int      @default(25)
  paymentDayType            String   @default("current")
  closingDay                Int      @default(31)
  defaultPayType            String   @default("monthly")
  standardWorkHours         Float    @default(8)
  standardWorkDays          Int      @default(20)
  enableHealthInsurance     Boolean  @default(true)
  enablePensionInsurance    Boolean  @default(true)
  enableEmploymentInsurance Boolean  @default(true)
  enableIncomeTax           Boolean  @default(true)
  enableResidentTax         Boolean  @default(true)
  createdAt                 DateTime @default(now())
  updatedAt                 DateTime

  @@index([tenantId])
}

model pc_assets {
  id                 String              @id
  tenantId           String
  assetNumber        String
  manufacturer       String
  model              String
  serialNumber       String
  cpu                String?
  memory             String?
  storage            String?
  os                 String?
  assignedUserId     String?
  assignedUserName   String?
  assignedDate       DateTime?           @db.Date
  ownershipType      String              @default("owned")
  purchaseDate       DateTime?           @db.Date
  purchaseCost       Int?
  leaseCompany       String?
  leaseMonthlyCost   Int?
  leaseStartDate     DateTime?           @db.Date
  leaseEndDate       DateTime?           @db.Date
  leaseContact       String?
  leasePhone         String?
  warrantyExpiration DateTime?           @db.Date
  status             String              @default("active")
  notes              String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime
  repair_records     repair_records[]
  software_licenses  software_licenses[]

  @@unique([tenantId, assetNumber])
  @@index([tenantId, assignedUserId])
  @@index([tenantId])
  @@index([tenantId, status])
}

model positions {
  id        String   @id
  tenantId  String
  name      String
  level     Int      @default(1)
  sortOrder Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime

  @@unique([tenantId, name])
  @@index([tenantId])
  @@index([tenantId, isActive])
  @@index([tenantId, level])
}

model pricing_tiers {
  id           String   @id
  tenantId     String?
  name         String
  minUsers     Int
  maxUsers     Int?
  pricePerUser Int
  order        Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  tenants      tenants? @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
}

model repair_records {
  id              String          @id
  tenantId        String
  pcAssetId       String?
  generalAssetId  String?
  repairType      String
  date            DateTime        @db.Date
  cost            Int
  vendorId        String?
  vendorName      String?
  symptom         String?
  description     String?
  status          String          @default("completed")
  completedDate   DateTime?       @db.Date
  performedBy     String?
  performedByName String?
  notes           String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime
  general_assets  general_assets? @relation(fields: [generalAssetId], references: [id], onDelete: Cascade)
  pc_assets       pc_assets?      @relation(fields: [pcAssetId], references: [id], onDelete: Cascade)

  @@index([generalAssetId])
  @@index([pcAssetId])
  @@index([tenantId, date])
  @@index([tenantId])
  @@index([tenantId, repairType])
}

model saas_license_assignments {
  id                 String             @id
  tenantId           String
  serviceId          String
  planId             String
  userId             String?
  userName           String?
  userEmail          String?
  departmentId       String?
  departmentName     String?
  status             String             @default("active")
  assignedDate       DateTime           @db.Date
  revokedDate        DateTime?          @db.Date
  lastUsedAt         DateTime?
  usageCount         Int?
  notes              String?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime
  saas_license_plans saas_license_plans @relation(fields: [planId], references: [id], onDelete: Cascade)
  saas_services      saas_services      @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@index([planId])
  @@index([serviceId])
  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, userId])
}

model saas_license_plans {
  id                       String                     @id
  tenantId                 String
  serviceId                String
  planName                 String
  billingCycle             String
  pricePerUser             Int?
  fixedPrice               Int?
  currency                 String                     @default("JPY")
  maxUsers                 Int?
  features                 String[]
  isActive                 Boolean                    @default(true)
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime
  saas_license_assignments saas_license_assignments[]
  saas_services            saas_services              @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@index([serviceId])
  @@index([tenantId])
}

model saas_monthly_costs {
  id               String        @id
  tenantId         String
  serviceId        String
  period           String
  userLicenseCount Int           @default(0)
  userLicenseCost  Int           @default(0)
  fixedCost        Int           @default(0)
  usageCost        Int           @default(0)
  totalCost        Int           @default(0)
  currency         String        @default("JPY")
  activeUserIds    String[]
  inactiveUserIds  String[]
  notes            String?
  createdAt        DateTime      @default(now())
  updatedAt        DateTime
  saas_services    saas_services @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@unique([serviceId, period])
  @@index([serviceId])
  @@index([tenantId])
  @@index([tenantId, period])
}

model saas_services {
  id                       String                     @id
  tenantId                 String
  name                     String
  category                 String
  vendor                   String?
  website                  String?
  logo                     String?
  description              String?
  licenseType              String
  securityRating           String?
  ssoEnabled               Boolean                    @default(false)
  mfaEnabled               Boolean                    @default(false)
  adminEmail               String?
  supportUrl               String?
  contractStartDate        DateTime?                  @db.Date
  contractEndDate          DateTime?                  @db.Date
  autoRenew                Boolean                    @default(false)
  isActive                 Boolean                    @default(true)
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime
  saas_license_assignments saas_license_assignments[]
  saas_license_plans       saas_license_plans[]
  saas_monthly_costs       saas_monthly_costs[]

  @@unique([tenantId, name])
  @@index([tenantId, category])
  @@index([tenantId])
  @@index([tenantId, isActive])
}

model software_licenses {
  id             String    @id
  tenantId       String
  pcAssetId      String
  softwareName   String
  licenseKey     String?
  expirationDate DateTime? @db.Date
  monthlyCost    Int?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime
  pc_assets      pc_assets @relation(fields: [pcAssetId], references: [id], onDelete: Cascade)

  @@index([pcAssetId])
  @@index([tenantId])
}

model stress_check_questions {
  id             String   @id
  tenantId       String?
  questionNumber Int
  category       String
  subcategory    String
  questionText   String
  isReverse      Boolean  @default(false)
  sortOrder      Int      @default(0)
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime

  @@unique([tenantId, questionNumber])
  @@index([category])
  @@index([tenantId])
}

model stress_check_summaries {
  id                      String   @id
  tenantId                String
  fiscalYear              Int
  totalEmployees          Int      @default(0)
  completedCount          Int      @default(0)
  pendingCount            Int      @default(0)
  completionRate          Float    @default(0)
  highStressCount         Int      @default(0)
  highStressRate          Float    @default(0)
  interviewRequestedCount Int      @default(0)
  interviewScheduledCount Int      @default(0)
  interviewCompletedCount Int      @default(0)
  avgStressFactorsScore   Float?
  avgStressResponseScore  Float?
  avgSocialSupportScore   Float?
  calculatedAt            DateTime @default(now())
  createdAt               DateTime @default(now())
  updatedAt               DateTime

  @@unique([tenantId, fiscalYear])
  @@index([tenantId, fiscalYear])
  @@index([tenantId])
}

model stress_checks {
  id                   String    @id
  tenantId             String
  userId               String
  userName             String
  fiscalYear           Int
  checkDate            DateTime? @db.Date
  status               String    @default("pending")
  stressFactorsScore   Int?
  stressResponseScore  Int?
  socialSupportScore   Int?
  totalScore           Int?
  isHighStress         Boolean   @default(false)
  highStressReason     String?
  interviewRequested   Boolean   @default(false)
  interviewRequestedAt DateTime?
  interviewScheduled   Boolean   @default(false)
  interviewScheduledAt DateTime?
  interviewCompleted   Boolean   @default(false)
  interviewCompletedAt DateTime?
  interviewNotes       String?
  doctorName           String?
  doctorOpinion        String?
  responses            Json?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime

  @@unique([tenantId, userId, fiscalYear])
  @@index([tenantId, fiscalYear])
  @@index([tenantId])
  @@index([tenantId, isHighStress])
  @@index([userId])
}

model tenant_legal_statuses {
  id            String        @id
  tenantId      String
  legalUpdateId String
  status        String        @default("pending")
  notes         String?
  completedAt   DateTime?
  completedBy   String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime
  legal_updates legal_updates @relation(fields: [legalUpdateId], references: [id], onDelete: Cascade)

  @@unique([tenantId, legalUpdateId])
  @@index([legalUpdateId])
  @@index([tenantId])
  @@index([tenantId, status])
}

model tenant_settings {
  id                String    @id
  tenantId          String    @unique
  trialEndDate      DateTime? @db.Date
  contractStartDate DateTime? @db.Date
  contractEndDate   DateTime? @db.Date
  billingEmail      String?
  customPricing     Boolean   @default(false)
  status            String    @default("trial")
  createdAt         DateTime  @default(now())
  updatedAt         DateTime
  tenants           tenants   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model tenants {
  id              String           @id
  name            String
  logo            String?
  timezone        String           @default("Asia/Tokyo")
  closingDay      String           @default("æœ«")
  weekStartDay    Int              @default(1)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime
  subdomain       String?          @unique
  attendance      attendance[]
  invoices        invoices[]
  org_units       org_units[]
  pricing_tiers   pricing_tiers[]
  tenant_settings tenant_settings?
  user_histories  user_histories[]
  users           users[]

  @@index([subdomain])
}

model timeline_entries {
  id                String            @id
  tenantId          String
  workflowId        String
  action            String
  actorId           String?
  actorName         String?
  details           String?
  createdAt         DateTime          @default(now())
  workflow_requests workflow_requests @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([tenantId, createdAt])
  @@index([tenantId])
  @@index([workflowId])
}

model user_account_settings {
  id                        String    @id
  tenantId                  String
  userId                    String    @unique
  displayName               String?
  avatar                    String?
  bio                       String?
  theme                     String    @default("system")
  language                  String    @default("ja")
  timezone                  String    @default("Asia/Tokyo")
  dateFormat                String    @default("YYYY/MM/DD")
  timeFormat                String    @default("24h")
  emailNotifications        Boolean   @default(true)
  pushNotifications         Boolean   @default(true)
  workflowNotifications     Boolean   @default(true)
  leaveNotifications        Boolean   @default(true)
  systemNotifications       Boolean   @default(true)
  announcementNotifications Boolean   @default(true)
  twoFactorEnabled          Boolean   @default(false)
  twoFactorSecret           String?
  passwordChangedAt         DateTime?
  lastLoginAt               DateTime?
  lastLoginIp               String?
  lastLoginDevice           String?
  createdAt                 DateTime  @default(now())
  updatedAt                 DateTime

  @@index([tenantId])
  @@index([userId])
}

model user_histories {
  id          String   @id
  tenantId    String
  userId      String
  action      String
  date        DateTime @db.Date
  userCount   Int
  dailyCharge Int
  memo        String?
  createdAt   DateTime @default(now())
  tenants     tenants  @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([date])
  @@index([tenantId, date])
  @@index([tenantId])
  @@index([userId])
}

model users {
  id               String       @id
  tenantId         String
  email            String       @unique
  name             String
  phone            String?
  hireDate         DateTime?
  unitId           String?
  roles            String[]
  status           String       @default("active")
  retiredDate      DateTime?
  retirementReason String?
  timezone         String       @default("Asia/Tokyo")
  avatar           String?
  position         String?
  department       String?
  createdAt        DateTime     @default(now())
  updatedAt        DateTime
  passwordHash     String?
  role             String?      @default("employee")
  attendance       attendance[]
  tenants          tenants      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  org_units        org_units?   @relation(fields: [unitId], references: [id])

  @@index([email])
  @@index([tenantId])
  @@index([tenantId, status])
  @@index([unitId])
}

model vehicles {
  id                  String                @id
  tenantId            String
  vehicleNumber       String
  licensePlate        String
  make                String
  model               String
  year                Int
  color               String?
  assignedUserId      String?
  assignedUserName    String?
  assignedDate        DateTime?             @db.Date
  ownershipType       String                @default("owned")
  purchaseDate        DateTime?             @db.Date
  purchaseCost        Int?
  leaseCompany        String?
  leaseMonthlyCost    Int?
  leaseStartDate      DateTime?             @db.Date
  leaseEndDate        DateTime?             @db.Date
  leaseContact        String?
  leasePhone          String?
  inspectionDate      DateTime?             @db.Date
  maintenanceDate     DateTime?             @db.Date
  insuranceDate       DateTime?             @db.Date
  currentTireType     String                @default("summer")
  status              String                @default("active")
  mileageTracking     Boolean               @default(true)
  currentMileage      Int?
  notes               String?
  createdAt           DateTime              @default(now())
  updatedAt           DateTime
  tireChangeDate      DateTime?             @db.Date
  maintenance_records maintenance_records[]
  monthly_mileages    monthly_mileages[]

  @@unique([tenantId, vehicleNumber])
  @@index([tenantId, assignedUserId])
  @@index([tenantId])
  @@index([tenantId, status])
}

model vendors {
  id                  String                @id
  tenantId            String
  name                String
  phone               String?
  address             String?
  contactPerson       String?
  email               String?
  rating              Int?
  notes               String?
  createdAt           DateTime              @default(now())
  updatedAt           DateTime
  maintenance_records maintenance_records[]

  @@index([tenantId])
  @@index([tenantId, name])
}

model work_experiences {
  id                String            @id
  tenantId          String
  profileId         String
  userId            String
  position          String
  company           String
  startDate         DateTime          @db.Date
  endDate           DateTime?         @db.Date
  isCurrent         Boolean           @default(false)
  description       String?
  achievements      String[]
  skills            String[]
  sortOrder         Int               @default(0)
  createdAt         DateTime          @default(now())
  updatedAt         DateTime
  employee_profiles employee_profiles @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
  @@index([tenantId])
  @@index([tenantId, isCurrent])
  @@index([userId])
}

model workflow_requests {
  id               String             @id
  tenantId         String
  requesterId      String
  requesterName    String
  department       String?
  type             String
  title            String
  description      String?
  amount           Float?
  days             Int?
  hours            Float?
  details          Json?
  status           String             @default("pending")
  currentStep      Int                @default(0)
  priority         String             @default("medium")
  dueDate          DateTime?
  completedAt      DateTime?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  approval_steps   approval_steps[]
  timeline_entries timeline_entries[]

  @@index([createdAt])
  @@index([requesterId])
  @@index([status])
  @@index([tenantId])
  @@index([tenantId, requesterId])
  @@index([tenantId, status])
  @@index([type])
}

model year_end_adjustment_settings {
  id                             String   @id
  tenantId                       String   @unique
  adjustmentStartMonth           Int      @default(11)
  adjustmentEndMonth             Int      @default(12)
  enableBasicDeduction           Boolean  @default(true)
  enableSpouseDeduction          Boolean  @default(true)
  enableDependentDeduction       Boolean  @default(true)
  enableInsuranceDeduction       Boolean  @default(true)
  enableSocialInsuranceDeduction Boolean  @default(true)
  withholdingSlipFormat          String   @default("standard")
  includeQRCode                  Boolean  @default(false)
  createdAt                      DateTime @default(now())
  updatedAt                      DateTime

  @@index([tenantId])
}
