// Dandori Portal Database Schema
// HRé ˜åŸŸç‰¹åŒ–ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒï¼ˆãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå®Œå…¨å¯¾å¿œï¼‰
//
// ğŸ¢ ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆè¨­è¨ˆ:
// - ã™ã¹ã¦ã®ä¸»è¦ãƒ†ãƒ¼ãƒ–ãƒ«ã« tenant_id ã‚’å«ã‚€
// - RDS PostgreSQL ã§ Row Level Security (RLS) å¯¾å¿œ
// - è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã§ã‚¯ã‚¨ãƒªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
// - 20ç¤¾Ã—30åè¦æ¨¡ï¼ˆ600ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰ã«æœ€é©åŒ–

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ãƒ†ãƒŠãƒ³ãƒˆï¼ˆä¼šç¤¾ï¼‰
model Tenant {
  id           String   @id @default(cuid())
  name         String
  subdomain    String?  @unique // ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆä¾‹: dandori-work, sample-corpï¼‰
  logo         String?
  timezone     String   @default("Asia/Tokyo")
  closingDay   String   @default("æœ«") // æœ«, 20, 15, ä»»æ„
  weekStartDay Int      @default(1) // 0=æ—¥æ›œ, 1=æœˆæ›œ
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  users         User[]
  orgUnits      OrgUnit[]
  attendance    Attendance[]
  pricingTiers  PricingTier[]
  invoices      Invoice[]
  settings      TenantSettings?
  userHistories UserHistory[]

  @@index([subdomain])
  @@map("tenants")
}

// çµ„ç¹”å˜ä½ï¼ˆä¼šç¤¾ã€éƒ¨é–€ã€éƒ¨ã€ãƒãƒ¼ãƒ ï¼‰
model OrgUnit {
  id          String   @id @default(cuid())
  tenantId    String
  name        String
  parentId    String?
  level       Int      @default(0)
  headUserId  String?
  type        String // company, division, department, team
  memberCount Int      @default(0)
  description String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  tenant   Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  parent   OrgUnit?  @relation("OrgUnitHierarchy", fields: [parentId], references: [id])
  children OrgUnit[] @relation("OrgUnitHierarchy")
  users    User[]

  @@index([tenantId])
  @@index([parentId])
  @@index([tenantId, parentId]) // è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆçµ„ç¹”éšå±¤æ¤œç´¢ç”¨ï¼‰
  @@index([tenantId, isActive]) // è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆæœ‰åŠ¹çµ„ç¹”æ¤œç´¢ç”¨ï¼‰
  @@map("org_units")
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼
model User {
  id               String    @id @default(cuid())
  tenantId         String
  email            String    @unique
  passwordHash     String? // bcrypt hashed password for authentication
  name             String
  phone            String?
  hireDate         DateTime?
  unitId           String?
  role             String?   @default("employee") // Primary role: admin, hr, manager, employee
  roles            String[] // JSONé…åˆ—: ["employee", "admin"]
  status           String    @default("active") // active, inactive, suspended, retired
  retiredDate      DateTime?
  retirementReason String? // voluntary, company, contract_end, retirement_age, other
  timezone         String    @default("Asia/Tokyo")
  avatar           String?
  position         String?
  department       String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  // Relations
  tenant     Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  orgUnit    OrgUnit?     @relation(fields: [unitId], references: [id])
  attendance Attendance[]

  @@index([tenantId])
  @@index([unitId])
  @@index([email])
  @@index([tenantId, status]) // è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢ç”¨ï¼‰
  @@map("users")
}

// å‹¤æ€ è¨˜éŒ²
model Attendance {
  id                String    @id @default(cuid())
  tenantId          String
  userId            String
  date              DateTime  @db.Date // YYYY-MM-DDå½¢å¼
  checkIn           DateTime? // å‡ºå‹¤æ™‚åˆ»
  checkOut          DateTime? // é€€å‹¤æ™‚åˆ»
  breakStart        DateTime? // ä¼‘æ†©é–‹å§‹æ™‚åˆ»
  breakEnd          DateTime? // ä¼‘æ†©çµ‚äº†æ™‚åˆ»
  totalBreakMinutes Int       @default(0)
  workMinutes       Int       @default(0)
  overtimeMinutes   Int       @default(0)
  workLocation      String    @default("office") // office, home, client, other
  checkInLocation   Json? // GPSä½ç½®æƒ…å ± {latitude, longitude, address, timestamp}
  checkOutLocation  Json? // GPSä½ç½®æƒ…å ± {latitude, longitude, address, timestamp}
  status            String    @default("present") // present, absent, holiday, leave, late, early
  memo              String?
  approvalStatus    String? // pending, approved, rejected
  approvalReason    String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // Relations
  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, date]) // 1ãƒ¦ãƒ¼ã‚¶ãƒ¼1æ—¥1ãƒ¬ã‚³ãƒ¼ãƒ‰
  @@index([tenantId])
  @@index([userId])
  @@index([tenantId, userId]) // è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆæœ€é©åŒ–ï¼‰
  @@index([tenantId, date]) // è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆæ—¥ä»˜ç¯„å›²æ¤œç´¢ç”¨ï¼‰
  @@index([date])
  @@index([status])
  @@map("attendance")
}

// ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ç”³è«‹
model WorkflowRequest {
  id            String    @id @default(cuid())
  tenantId      String
  requesterId   String // ç”³è«‹è€…ID
  requesterName String // ç”³è«‹è€…å
  department    String? // éƒ¨ç½²
  type          String // leave, overtime, expense, business_trip, purchase, attendance_correction
  title         String // ç”³è«‹ã‚¿ã‚¤ãƒˆãƒ«
  description   String? // ç”³è«‹å†…å®¹
  amount        Float? // é‡‘é¡ï¼ˆçµŒè²»ãƒ»è³¼è²·ç”³è«‹ç”¨ï¼‰
  days          Int? // æ—¥æ•°ï¼ˆä¼‘æš‡ç”³è«‹ç”¨ï¼‰
  hours         Float? // æ™‚é–“æ•°ï¼ˆæ®‹æ¥­ç”³è«‹ç”¨ï¼‰
  details       Json? // ãã®ä»–è©³ç´°æƒ…å ±
  status        String    @default("pending") // pending, in_progress, approved, rejected, withdrawn
  currentStep   Int       @default(0)
  priority      String    @default("medium") // low, medium, high, urgent
  dueDate       DateTime?
  completedAt   DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  approvalSteps   ApprovalStep[]
  timelineEntries TimelineEntry[]

  @@index([tenantId])
  @@index([requesterId])
  @@index([tenantId, requesterId]) // è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ç”³è«‹ä¸€è¦§ç”¨ï¼‰
  @@index([tenantId, status]) // è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥æ¤œç´¢ç”¨ï¼‰
  @@index([status])
  @@index([type])
  @@index([createdAt])
  @@map("workflow_requests")
}

// æ‰¿èªã‚¹ãƒ†ãƒƒãƒ—
model ApprovalStep {
  id            String    @id @default(cuid())
  tenantId      String // éæ­£è¦åŒ–ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼‰
  workflowId    String
  order         Int // ã‚¹ãƒ†ãƒƒãƒ—ã®é †åºï¼ˆ0å§‹ã¾ã‚Šï¼‰
  approverRole  String // direct_manager, hr_manager, finance_manager, etc.
  approverId    String? // æ‰¿èªè€…ID
  approverName  String? // æ‰¿èªè€…å
  status        String    @default("pending") // pending, approved, rejected, skipped
  actionDate    DateTime? // æ‰¿èª/å´ä¸‹æ—¥æ™‚
  comments      String? // ã‚³ãƒ¡ãƒ³ãƒˆ
  executionMode String    @default("sequential") // sequential, parallel
  timeoutHours  Int? // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“
  isEscalated   Boolean   @default(false)
  escalatedTo   String? // ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å…ˆ
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  workflow WorkflowRequest @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([workflowId])
  @@index([tenantId, approverId]) // è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆæ‰¿èªè€…åˆ¥ã‚¿ã‚¹ã‚¯ä¸€è¦§ç”¨ï¼‰
  @@index([tenantId, status]) // è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥æ¤œç´¢ç”¨ï¼‰
  @@index([approverId])
  @@index([status])
  @@map("approval_steps")
}

// ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ï¼ˆå±¥æ­´ï¼‰
model TimelineEntry {
  id         String   @id @default(cuid())
  tenantId   String // éæ­£è¦åŒ–ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼‰
  workflowId String
  action     String // created, submitted, approved, rejected, returned, escalated, etc.
  actorId    String? // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œè€…ID
  actorName  String? // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œè€…å
  details    String? // è©³ç´°æƒ…å ±
  createdAt  DateTime @default(now())

  // Relations
  workflow WorkflowRequest @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([workflowId])
  @@index([tenantId, createdAt]) // è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆãƒ†ãƒŠãƒ³ãƒˆåˆ¥ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ï¼‰
  @@index([createdAt])
  @@map("timeline_entries")
}

// ä¼‘æš‡ç”³è«‹
model LeaveRequest {
  id             String    @id @default(cuid())
  tenantId       String
  userId         String
  userName       String
  type           String // paid, sick, special, compensatory, half_day_am, half_day_pm
  startDate      DateTime  @db.Date
  endDate        DateTime  @db.Date
  days           Float // æ—¥æ•°ï¼ˆ0.5ã®åŠä¼‘ã‚‚å¯¾å¿œï¼‰
  reason         String
  attachments    Json? // æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ï¼ˆè¨ºæ–­æ›¸ãªã©ï¼‰[{id, name, size, type, url, uploadedAt}]
  status         String    @default("draft") // draft, pending, approved, rejected, cancelled
  approver       String? // æ‰¿èªè€…ID
  approverName   String? // æ‰¿èªè€…å
  approvedDate   DateTime?
  rejectedReason String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@index([tenantId])
  @@index([userId])
  @@index([tenantId, userId]) // è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ä¼‘æš‡ä¸€è¦§ç”¨ï¼‰
  @@index([tenantId, status]) // è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥æ¤œç´¢ç”¨ï¼‰
  @@index([tenantId, startDate]) // è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆæ—¥ä»˜ç¯„å›²æ¤œç´¢ç”¨ï¼‰
  @@index([status])
  @@index([startDate])
  @@index([endDate])
  @@map("leave_requests")
}

// ä¼‘æš‡æ®‹æ•°
model LeaveBalance {
  id                         String   @id @default(cuid())
  tenantId                   String
  userId                     String
  year                       Int
  paidLeaveTotal             Int      @default(0)
  paidLeaveUsed              Float    @default(0)
  paidLeaveRemaining         Float    @default(0)
  paidLeaveExpiry            DateTime @db.Date
  sickLeaveTotal             Int      @default(0)
  sickLeaveUsed              Float    @default(0)
  sickLeaveRemaining         Float    @default(0)
  specialLeaveTotal          Int      @default(0)
  specialLeaveUsed           Float    @default(0)
  specialLeaveRemaining      Float    @default(0)
  compensatoryLeaveTotal     Int      @default(0)
  compensatoryLeaveUsed      Float    @default(0)
  compensatoryLeaveRemaining Float    @default(0)
  createdAt                  DateTime @default(now())
  updatedAt                  DateTime @updatedAt

  @@unique([userId, year])
  @@index([tenantId])
  @@index([userId])
  @@index([tenantId, userId]) // è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ä¼‘æš‡æ®‹æ•°æ¤œç´¢ç”¨ï¼‰
  @@map("leave_balances")
}

// ========================================
// ãƒ†ãƒŠãƒ³ãƒˆç®¡ç†ãƒ»è«‹æ±‚æ›¸æ©Ÿèƒ½
// ========================================

// æ–™é‡‘ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå„ãƒ†ãƒŠãƒ³ãƒˆã”ã¨ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ï¼‰
model PricingTier {
  id           String   @id @default(cuid())
  tenantId     String? // nullã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ–™é‡‘
  name         String // "1-10äºº", "11-50äºº", "51äººä»¥ä¸Š"
  minUsers     Int // æœ€å°ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°
  maxUsers     Int? // æœ€å¤§ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ï¼ˆnullã®å ´åˆã¯ç„¡åˆ¶é™ï¼‰
  pricePerUser Int // 1äººã‚ãŸã‚Šã®æ–™é‡‘ï¼ˆç¨æŠœãƒ»å††ï¼‰
  order        Int      @default(0) // è¡¨ç¤ºé †åº
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  tenant Tenant? @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@map("pricing_tiers")
}

// è«‹æ±‚æ›¸
model Invoice {
  id            String    @id @default(cuid())
  invoiceNumber String    @unique // INV-2025-11-001
  tenantId      String
  billingMonth  DateTime  @db.Date // è«‹æ±‚æœˆï¼ˆ2025-11-01ï¼‰
  subtotal      Int // å°è¨ˆï¼ˆç¨æŠœãƒ»å††ï¼‰
  tax           Int // æ¶ˆè²»ç¨ï¼ˆå††ï¼‰
  total         Int // åˆè¨ˆï¼ˆç¨è¾¼ãƒ»å††ï¼‰
  status        String    @default("draft") // draft, sent, paid
  dueDate       DateTime  @db.Date // æ”¯æ‰•ã„æœŸé™
  paidDate      DateTime? @db.Date // æ”¯æ‰•æ—¥
  sentDate      DateTime? // ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ—¥æ™‚
  billingEmail  String // è«‹æ±‚å…ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
  memo          String? // ãƒ¡ãƒ¢
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  tenant Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  items  InvoiceItem[]

  @@index([tenantId])
  @@index([status])
  @@index([billingMonth])
  @@index([invoiceNumber])
  @@index([tenantId, billingMonth]) // è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆãƒ†ãƒŠãƒ³ãƒˆåˆ¥è«‹æ±‚æ›¸æ¤œç´¢ç”¨ï¼‰
  @@index([tenantId, status]) // è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥æ¤œç´¢ç”¨ï¼‰
  @@map("invoices")
}

// è«‹æ±‚æ˜ç´°
model InvoiceItem {
  id          String  @id @default(cuid())
  invoiceId   String
  description String // "ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼ 49åï¼ˆ11/1-11/30ï¼‰"
  quantity    Int // ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°
  unitPrice   Int // å˜ä¾¡ï¼ˆç¨æŠœãƒ»å††ï¼‰
  amount      Int // é‡‘é¡ï¼ˆç¨æŠœãƒ»å††ï¼‰
  period      String? // "2025-11-01 ã€œ 2025-11-30"

  // Relations
  invoice Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId])
  @@map("invoice_items")
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¥æ­´ï¼ˆæ—¥å‰²ã‚Šè¨ˆç®—ç”¨ï¼‰
model UserHistory {
  id          String   @id @default(cuid())
  tenantId    String
  userId      String
  action      String // added, activated, deactivated, deleted
  date        DateTime @db.Date // æ“ä½œæ—¥
  userCount   Int // æ“ä½œå¾Œã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°
  dailyCharge Int // æ—¥æ¬¡æ–™é‡‘ï¼ˆç¨è¾¼ãƒ»å††ï¼‰
  memo        String?
  createdAt   DateTime @default(now())

  // Relations
  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([userId])
  @@index([date])
  @@index([tenantId, date]) // è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆãƒ†ãƒŠãƒ³ãƒˆåˆ¥èª²é‡‘å±¥æ­´æ¤œç´¢ç”¨ï¼‰
  @@map("user_histories")
}

// ãƒ†ãƒŠãƒ³ãƒˆè¨­å®š
model TenantSettings {
  id                String    @id @default(cuid())
  tenantId          String    @unique
  trialEndDate      DateTime? @db.Date // ç„¡æ–™ãƒˆãƒ©ã‚¤ã‚¢ãƒ«çµ‚äº†æ—¥
  contractStartDate DateTime? @db.Date // å¥‘ç´„é–‹å§‹æ—¥
  contractEndDate   DateTime? @db.Date // å¥‘ç´„çµ‚äº†æ—¥
  billingEmail      String? // è«‹æ±‚å…ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
  customPricing     Boolean   @default(false) // ã‚«ã‚¹ã‚¿ãƒ æ–™é‡‘è¨­å®šãƒ•ãƒ©ã‚°
  status            String    @default("trial") // trial, active, suspended, cancelled
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // Relations
  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("tenant_settings")
}

// ========================================
// ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆéƒ¨ç½²ãƒ»å½¹è·ãƒ»é›‡ç”¨å½¢æ…‹ï¼‰
// ========================================

// éƒ¨ç½²ãƒã‚¹ã‚¿
model Department {
  id        String   @id @default(cuid())
  tenantId  String
  name      String
  parentId  String? // è¦ªéƒ¨ç½²IDï¼ˆéšå±¤æ§‹é€ ç”¨ï¼‰
  sortOrder Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationsï¼ˆè‡ªå·±å‚ç…§ã¯å‰Šé™¤ã—ã¦ã‚·ãƒ³ãƒ—ãƒ«åŒ–ï¼‰

  @@unique([tenantId, name]) // åŒä¸€ãƒ†ãƒŠãƒ³ãƒˆå†…ã§éƒ¨ç½²åã¯é‡è¤‡ä¸å¯
  @@index([tenantId])
  @@index([tenantId, isActive])
  @@index([tenantId, sortOrder])
  @@map("departments")
}

// å½¹è·ãƒã‚¹ã‚¿
model Position {
  id        String   @id @default(cuid())
  tenantId  String
  name      String
  level     Int      @default(1) // å½¹è·ãƒ¬ãƒ™ãƒ«ï¼ˆ1: ä¸€èˆ¬, 2: ä¸»ä»», 3: ä¿‚é•·, 4: èª²é•·, 5: éƒ¨é•·, 6: å½¹å“¡, 7: ä»£è¡¨ï¼‰
  sortOrder Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([tenantId, name]) // åŒä¸€ãƒ†ãƒŠãƒ³ãƒˆå†…ã§å½¹è·åã¯é‡è¤‡ä¸å¯
  @@index([tenantId])
  @@index([tenantId, isActive])
  @@index([tenantId, level])
  @@map("positions")
}

// é›‡ç”¨å½¢æ…‹ãƒã‚¹ã‚¿
model EmploymentType {
  id        String   @id @default(cuid())
  tenantId  String
  name      String
  sortOrder Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([tenantId, name]) // åŒä¸€ãƒ†ãƒŠãƒ³ãƒˆå†…ã§é›‡ç”¨å½¢æ…‹åã¯é‡è¤‡ä¸å¯
  @@index([tenantId])
  @@index([tenantId, isActive])
  @@map("employment_types")
}

// ========================================
// æ‰¿èªãƒ•ãƒ­ãƒ¼å®šç¾©
// ========================================

// æ‰¿èªãƒ•ãƒ­ãƒ¼å®šç¾©ï¼ˆãƒã‚¹ã‚¿ï¼‰
model ApprovalFlowDefinition {
  id                       String   @id @default(cuid())
  tenantId                 String
  name                     String // ãƒ•ãƒ­ãƒ¼å
  description              String? // èª¬æ˜
  documentType             String // leave_request, overtime_request, expense_claim, business_trip, purchase_request
  flowType                 String // organizationï¼ˆçµ„ç¹”é€£å‹•ï¼‰, customï¼ˆã‚«ã‚¹ã‚¿ãƒ ï¼‰
  useOrganizationHierarchy Boolean  @default(false) // çµ„ç¹”é€£å‹•å‹ã®å ´åˆtrue
  organizationLevels       Int? // çµ„ç¹”é€£å‹•å‹: ä½•éšå±¤ä¸Šã¾ã§æ‰¿èªãŒå¿…è¦ã‹ï¼ˆ1-5ï¼‰
  isActive                 Boolean  @default(true)
  isDefault                Boolean  @default(false) // ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¿ã‚¤ãƒ—ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ•ãƒ­ãƒ¼
  priority                 Int      @default(1) // å„ªå…ˆåº¦ï¼ˆæ¡ä»¶åˆ†å²æ™‚ã®åˆ¤å®šé †ï¼‰
  createdBy                String // ä½œæˆè€…ID
  createdAt                DateTime @default(now())
  updatedAt                DateTime @updatedAt

  // Relations
  steps      ApprovalFlowStep[]
  conditions ApprovalFlowCondition[]

  // Note: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ•ãƒ­ãƒ¼ã®ä¸€æ„æ€§ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ãƒ™ãƒ«ã§åˆ¶å¾¡
  @@index([tenantId])
  @@index([tenantId, documentType])
  @@index([tenantId, documentType, isActive])
  @@map("approval_flow_definitions")
}

// æ‰¿èªãƒ•ãƒ­ãƒ¼ã‚¹ãƒ†ãƒƒãƒ—å®šç¾©ï¼ˆã‚«ã‚¹ã‚¿ãƒ å‹ç”¨ï¼‰
model ApprovalFlowStep {
  id                String   @id @default(cuid())
  flowId            String
  stepNumber        Int // ã‚¹ãƒ†ãƒƒãƒ—ç•ªå·ï¼ˆ1å§‹ã¾ã‚Šï¼‰
  name              String // ã‚¹ãƒ†ãƒƒãƒ—åï¼ˆä¾‹: ç›´å±ä¸Šå¸æ‰¿èªã€éƒ¨é•·æ‰¿èªï¼‰
  executionMode     String   @default("serial") // serialï¼ˆé †æ¬¡ï¼‰, parallelï¼ˆä¸¦åˆ—ï¼‰
  requiredApprovals Int      @default(1) // å¿…è¦æ‰¿èªæ•°ï¼ˆä¸¦åˆ—æ™‚ï¼‰
  timeoutHours      Int? // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“
  allowDelegate     Boolean  @default(true) // ä»£ç†æ‰¿èªã‚’è¨±å¯
  allowSkip         Boolean  @default(false) // ã‚¹ã‚­ãƒƒãƒ—ã‚’è¨±å¯
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  flow      ApprovalFlowDefinition @relation(fields: [flowId], references: [id], onDelete: Cascade)
  approvers ApprovalFlowApprover[]

  @@index([flowId])
  @@index([flowId, stepNumber])
  @@map("approval_flow_steps")
}

// æ‰¿èªãƒ•ãƒ­ãƒ¼ã‚¹ãƒ†ãƒƒãƒ—ã®æ‰¿èªè€…å®šç¾©
model ApprovalFlowApprover {
  id            String   @id @default(cuid())
  stepId        String
  approverType  String // userï¼ˆç‰¹å®šãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰, roleï¼ˆå½¹è·ï¼‰, position_levelï¼ˆå½¹è·ãƒ¬ãƒ™ãƒ«ä»¥ä¸Šï¼‰
  approverId    String? // approverType=userã®å ´åˆ: ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
  approverRole  String? // approverType=roleã®å ´åˆ: manager, hr, financeç­‰
  positionLevel Int? // approverType=position_levelã®å ´åˆ: å½¹è·ãƒ¬ãƒ™ãƒ«
  order         Int      @default(1) // æ‰¿èªè€…ã®é †åºï¼ˆä¸¦åˆ—æ™‚ï¼‰
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  step ApprovalFlowStep @relation(fields: [stepId], references: [id], onDelete: Cascade)

  @@index([stepId])
  @@map("approval_flow_approvers")
}

// æ‰¿èªãƒ•ãƒ­ãƒ¼é©ç”¨æ¡ä»¶
model ApprovalFlowCondition {
  id          String   @id @default(cuid())
  flowId      String
  field       String // æ¡ä»¶åˆ¤å®šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆamount, days, hoursç­‰ï¼‰
  operator    String // æ¼”ç®—å­ï¼ˆgte, lte, gt, lt, eq, neï¼‰
  value       Float // æ¯”è¼ƒå€¤
  description String? // æ¡ä»¶ã®èª¬æ˜ï¼ˆä¾‹: 5æ—¥ä»¥ä¸Šã®ä¼‘æš‡ï¼‰
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  flow ApprovalFlowDefinition @relation(fields: [flowId], references: [id], onDelete: Cascade)

  @@index([flowId])
  @@map("approval_flow_conditions")
}

// ========================================
// ä¼šç¤¾è¨­å®šï¼ˆCompany Settingsï¼‰
// ========================================

// ä¼šç¤¾æƒ…å ±
model CompanySettings {
  id       String @id @default(cuid())
  tenantId String @unique // 1ãƒ†ãƒŠãƒ³ãƒˆ1è¨­å®š

  // åŸºæœ¬æƒ…å ±
  name       String // ä¼šç¤¾å
  nameKana   String? // ä¼šç¤¾åï¼ˆã‚«ãƒŠï¼‰
  postalCode String? // éƒµä¾¿ç•ªå·
  address    String? // ä½æ‰€
  phone      String? // é›»è©±ç•ªå·
  fax        String? // FAXç•ªå·
  email      String? // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹

  // æ³•äººæƒ…å ±
  corporateNumber     String? // æ³•äººç•ªå·ï¼ˆ13æ¡ï¼‰
  representativeName  String? // ä»£è¡¨è€…å
  representativeTitle String? // ä»£è¡¨è€…å½¹è·

  // ç¨å‹™æƒ…å ±
  taxOffice     String? // æ‰€è½„ç¨å‹™ç½²
  taxOfficeCode String? // ç¨å‹™ç½²ã‚³ãƒ¼ãƒ‰

  // ãã®ä»–
  fiscalYearEnd String? // æ±ºç®—æœˆï¼ˆMMå½¢å¼ï¼‰
  foundedDate   DateTime? @db.Date // è¨­ç«‹æ—¥

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([tenantId])
  @@map("company_settings")
}

// çµ¦ä¸è¨­å®š
model PayrollSettings {
  id       String @id @default(cuid())
  tenantId String @unique // 1ãƒ†ãƒŠãƒ³ãƒˆ1è¨­å®š

  // æ”¯çµ¦æ—¥è¨­å®š
  paymentDay     Int    @default(25) // æ”¯çµ¦æ—¥ï¼ˆ1-31ï¼‰
  paymentDayType String @default("current") // currentï¼ˆå½“æœˆæ‰•ã„ï¼‰/ nextï¼ˆç¿Œæœˆæ‰•ã„ï¼‰

  // ç· ã‚æ—¥è¨­å®š
  closingDay Int @default(31) // ç· ã‚æ—¥ï¼ˆ1-31ã€æœ«æ—¥ã¯31ï¼‰

  // çµ¦ä¸ä½“ç³»
  defaultPayType String @default("monthly") // monthly / hourly / daily

  // æ™‚é–“è¨­å®š
  standardWorkHours Float @default(8) // æ‰€å®šåŠ´åƒæ™‚é–“/æ—¥
  standardWorkDays  Int   @default(20) // æ‰€å®šåŠ´åƒæ—¥æ•°/æœˆ

  // æ§é™¤è¨­å®š
  enableHealthInsurance     Boolean @default(true) // å¥åº·ä¿é™º
  enablePensionInsurance    Boolean @default(true) // åšç”Ÿå¹´é‡‘
  enableEmploymentInsurance Boolean @default(true) // é›‡ç”¨ä¿é™º
  enableIncomeTax           Boolean @default(true) // æ‰€å¾—ç¨
  enableResidentTax         Boolean @default(true) // ä½æ°‘ç¨

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([tenantId])
  @@map("payroll_settings")
}

// å‹¤æ€ è¨­å®š
model AttendanceSettings {
  id       String @id @default(cuid())
  tenantId String @unique // 1ãƒ†ãƒŠãƒ³ãƒˆ1è¨­å®š

  // å‹¤å‹™æ™‚é–“è¨­å®š
  workStartTime        String @default("09:00") // å§‹æ¥­æ™‚åˆ»
  workEndTime          String @default("18:00") // çµ‚æ¥­æ™‚åˆ»
  breakStartTime       String @default("12:00") // ä¼‘æ†©é–‹å§‹æ™‚åˆ»
  breakEndTime         String @default("13:00") // ä¼‘æ†©çµ‚äº†æ™‚åˆ»
  breakDurationMinutes Int    @default(60) // ä¼‘æ†©æ™‚é–“ï¼ˆåˆ†ï¼‰

  // ãƒ•ãƒ¬ãƒƒã‚¯ã‚¹è¨­å®š
  enableFlexTime Boolean @default(false) // ãƒ•ãƒ¬ãƒƒã‚¯ã‚¹åˆ¶åº¦
  coreTimeStart  String? // ã‚³ã‚¢ã‚¿ã‚¤ãƒ é–‹å§‹
  coreTimeEnd    String? // ã‚³ã‚¢ã‚¿ã‚¤ãƒ çµ‚äº†

  // æ®‹æ¥­è¨­å®š
  overtimeThresholdMinutes Int @default(480) // æ®‹æ¥­è¨ˆç®—é–‹å§‹ï¼ˆåˆ†ï¼‰= 8æ™‚é–“
  maxOvertimeHoursPerMonth Int @default(45) // æœˆé–“æ®‹æ¥­ä¸Šé™ï¼ˆæ™‚é–“ï¼‰

  // æ‰“åˆ»è¨­å®š
  allowRemoteCheckIn       Boolean @default(true) // ãƒªãƒ¢ãƒ¼ãƒˆæ‰“åˆ»è¨±å¯
  requireLocationOnCheckIn Boolean @default(false) // ä½ç½®æƒ…å ±å¿…é ˆ
  allowEarlyCheckIn        Boolean @default(true) // æ—©å‡ºæ‰“åˆ»è¨±å¯
  earlyCheckInMinutes      Int     @default(30) // æ—©å‡ºè¨±å®¹æ™‚é–“ï¼ˆåˆ†ï¼‰

  // ä¼‘æ—¥è¨­å®š
  weeklyHolidays String[] @default(["saturday", "sunday"]) // é€±ä¼‘æ—¥

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([tenantId])
  @@map("attendance_settings")
}

// å¹´æœ«èª¿æ•´è¨­å®š
model YearEndAdjustmentSettings {
  id       String @id @default(cuid())
  tenantId String @unique // 1ãƒ†ãƒŠãƒ³ãƒˆ1è¨­å®š

  // å¹´æœ«èª¿æ•´æœŸé–“
  adjustmentStartMonth Int @default(11) // é–‹å§‹æœˆï¼ˆé€šå¸¸11æœˆï¼‰
  adjustmentEndMonth   Int @default(12) // çµ‚äº†æœˆï¼ˆé€šå¸¸12æœˆï¼‰

  // æ§é™¤é …ç›®
  enableBasicDeduction           Boolean @default(true) // åŸºç¤æ§é™¤
  enableSpouseDeduction          Boolean @default(true) // é…å¶è€…æ§é™¤
  enableDependentDeduction       Boolean @default(true) // æ‰¶é¤Šæ§é™¤
  enableInsuranceDeduction       Boolean @default(true) // ç”Ÿå‘½ä¿é™ºæ–™æ§é™¤
  enableSocialInsuranceDeduction Boolean @default(true) // ç¤¾ä¼šä¿é™ºæ–™æ§é™¤

  // æºæ³‰å¾´åç¥¨è¨­å®š
  withholdingSlipFormat String  @default("standard") // standard / detailed
  includeQRCode         Boolean @default(false) // QRã‚³ãƒ¼ãƒ‰ä»˜ä¸ï¼ˆe-Taxå¯¾å¿œï¼‰

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([tenantId])
  @@map("year_end_adjustment_settings")
}

// ========================================
// æ³•ä»¤ãƒ»åˆ¶åº¦æ›´æ–°ï¼ˆDWç¤¾ä¸€æ‹¬ç®¡ç† â†’ å…¨ãƒ†ãƒŠãƒ³ãƒˆé…ä¿¡ï¼‰
// ========================================

// æ³•ä»¤ãƒ»åˆ¶åº¦æ›´æ–°ãƒã‚¹ã‚¿ï¼ˆDWç¤¾ãŒç®¡ç†ï¼‰
model LegalUpdate {
  id String @id @default(cuid())

  // åŸºæœ¬æƒ…å ±
  title       String // ã‚¿ã‚¤ãƒˆãƒ«
  description String? @db.Text // è©³ç´°èª¬æ˜
  category    String // taxï¼ˆç¨å‹™ï¼‰, laborï¼ˆåŠ´å‹™ï¼‰, social_insuranceï¼ˆç¤¾ä¼šä¿é™ºï¼‰, payrollï¼ˆçµ¦ä¸è¨ˆç®—ï¼‰, attendanceï¼ˆå‹¤æ€ ç®¡ç†ï¼‰, safetyï¼ˆå®‰å…¨è¡›ç”Ÿï¼‰, otherï¼ˆãã®ä»–ï¼‰

  // æ–½è¡Œæƒ…å ±
  effectiveDate DateTime @db.Date // æ–½è¡Œæ—¥
  relatedLaws   String? // é–¢é€£æ³•ä»¤å
  affectedAreas String[] // å½±éŸ¿ç¯„å›²ï¼ˆä¾‹: ["äººäº‹ç®¡ç†", "é›‡ç”¨ç®¡ç†"]ï¼‰

  // å„ªå…ˆåº¦ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  priority    String    @default("medium") // high, medium, low
  isPublished Boolean   @default(false) // å…¬é–‹ãƒ•ãƒ©ã‚°
  publishedAt DateTime? // å…¬é–‹æ—¥æ™‚

  // å‚è€ƒæƒ…å ±
  referenceUrl String? // å‚è€ƒURLï¼ˆå®˜å ±ãƒ»çœåºã‚µã‚¤ãƒˆç­‰ï¼‰
  attachments  Json? // æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±

  // ãƒ¡ã‚¿æƒ…å ±
  createdBy String? // ä½œæˆè€…ï¼ˆDWç¤¾ã‚¹ã‚¿ãƒƒãƒ•IDï¼‰
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  tenantStatuses TenantLegalStatus[]

  @@index([category])
  @@index([effectiveDate])
  @@index([isPublished])
  @@index([priority])
  @@index([isPublished, effectiveDate])
  @@map("legal_updates")
}

// ãƒ†ãƒŠãƒ³ãƒˆåˆ¥ã®æ³•ä»¤å¯¾å¿œçŠ¶æ³
model TenantLegalStatus {
  id            String @id @default(cuid())
  tenantId      String
  legalUpdateId String

  // å¯¾å¿œçŠ¶æ³
  status      String    @default("pending") // pendingï¼ˆæœªå¯¾å¿œï¼‰, in_progressï¼ˆå¯¾å¿œä¸­ï¼‰, completedï¼ˆå¯¾å¿œæ¸ˆã¿ï¼‰
  notes       String?   @db.Text // ãƒ¡ãƒ¢ãƒ»å‚™è€ƒ
  completedAt DateTime? // å¯¾å¿œå®Œäº†æ—¥æ™‚
  completedBy String? // å¯¾å¿œå®Œäº†è€…

  // ãƒ¡ã‚¿æƒ…å ±
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  legalUpdate LegalUpdate @relation(fields: [legalUpdateId], references: [id], onDelete: Cascade)

  @@unique([tenantId, legalUpdateId]) // 1ãƒ†ãƒŠãƒ³ãƒˆ1æ³•ä»¤ã«å¯¾ã—ã¦1ãƒ¬ã‚³ãƒ¼ãƒ‰
  @@index([tenantId])
  @@index([legalUpdateId])
  @@index([tenantId, status])
  @@map("tenant_legal_statuses")
}

// ========================================
// è³‡ç”£ç®¡ç†ï¼ˆè»Šä¸¡ãƒ»PCï¼‰
// ========================================

// æ¥­è€…ãƒã‚¹ã‚¿
model Vendor {
  id            String   @id @default(cuid())
  tenantId      String
  name          String // æ¥­è€…å
  phone         String? // é›»è©±ç•ªå·
  address       String? // ä½æ‰€
  contactPerson String? // æ‹…å½“è€…å
  email         String? // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
  rating        Int? // è©•ä¾¡ï¼ˆ1-5ï¼‰
  notes         String?  @db.Text // ãƒ¡ãƒ¢
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  maintenanceRecords MaintenanceRecord[]

  @@index([tenantId])
  @@index([tenantId, name])
  @@map("vendors")
}

// è»Šä¸¡ãƒã‚¹ã‚¿
model Vehicle {
  id            String  @id @default(cuid())
  tenantId      String
  vehicleNumber String // è»Šä¸¡ç•ªå·ï¼ˆç¤¾å†…ç®¡ç†ç•ªå·ï¼‰
  licensePlate  String // ãƒŠãƒ³ãƒãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆ
  make          String // ãƒ¡ãƒ¼ã‚«ãƒ¼
  model         String // è»Šç¨®
  year          Int // å¹´å¼
  color         String? // è‰²

  // å‰²å½“æƒ…å ±
  assignedUserId   String? // å‰²å½“ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
  assignedUserName String? // å‰²å½“ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼ˆå‚ç…§ç”¨ï¼‰
  assignedDate     DateTime? @db.Date // å‰²å½“æ—¥

  // æ‰€æœ‰ãƒ»ãƒªãƒ¼ã‚¹æƒ…å ±
  ownershipType    String    @default("owned") // owned, leased, rental
  purchaseDate     DateTime? @db.Date // è³¼å…¥æ—¥
  purchaseCost     Int? // è³¼å…¥ä¾¡æ ¼
  leaseCompany     String? // ãƒªãƒ¼ã‚¹ä¼šç¤¾
  leaseMonthlyCost Int? // ãƒªãƒ¼ã‚¹æœˆé¡
  leaseStartDate   DateTime? @db.Date // ãƒªãƒ¼ã‚¹é–‹å§‹æ—¥
  leaseEndDate     DateTime? @db.Date // ãƒªãƒ¼ã‚¹çµ‚äº†æ—¥
  leaseContact     String? // ãƒªãƒ¼ã‚¹æ‹…å½“è€…
  leasePhone       String? // ãƒªãƒ¼ã‚¹é›»è©±ç•ªå·

  // æœŸé™ç®¡ç†
  inspectionDate  DateTime? @db.Date // æ¬¡å›è»Šæ¤œæ—¥
  maintenanceDate DateTime? @db.Date // æ¬¡å›ç‚¹æ¤œæ—¥
  insuranceDate   DateTime? @db.Date // ä¿é™ºæ›´æ–°æ—¥

  // ã‚¿ã‚¤ãƒ¤æƒ…å ±
  currentTireType String    @default("summer") // summer, winter
  tireChangeDate  DateTime? @db.Date // æ¬¡å›ã‚¿ã‚¤ãƒ¤å±¥ãæ›¿ãˆäºˆå®šæ—¥

  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  status String @default("active") // active, maintenance, retired

  // èµ°è¡Œè·é›¢ç®¡ç†
  mileageTracking Boolean @default(true) // èµ°è¡Œè·é›¢ç®¡ç†ON/OFF
  currentMileage  Int? // ç¾åœ¨ã®ç·èµ°è¡Œè·é›¢

  notes     String?  @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  monthlyMileages    MonthlyMileage[]
  maintenanceRecords MaintenanceRecord[]

  @@unique([tenantId, vehicleNumber])
  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, assignedUserId])
  @@map("vehicles")
}

// æœˆæ¬¡èµ°è¡Œè·é›¢
model MonthlyMileage {
  id             String   @id @default(cuid())
  tenantId       String
  vehicleId      String
  month          String // YYYY-MM
  distance       Int // km
  recordedBy     String? // è¨˜éŒ²è€…ID
  recordedByName String? // è¨˜éŒ²è€…å
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relations
  vehicle Vehicle @relation(fields: [vehicleId], references: [id], onDelete: Cascade)

  @@unique([vehicleId, month])
  @@index([tenantId])
  @@index([vehicleId])
  @@map("monthly_mileages")
}

// ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹è¨˜éŒ²
model MaintenanceRecord {
  id              String    @id @default(cuid())
  tenantId        String
  vehicleId       String
  type            String // oil_change, tire_change, inspection, shaken, repair, other
  date            DateTime  @db.Date
  mileage         Int? // å®Ÿæ–½æ™‚ã®èµ°è¡Œè·é›¢
  cost            Int // è²»ç”¨
  vendorId        String? // æ¥­è€…ID
  description     String? // èª¬æ˜
  nextDueDate     DateTime? @db.Date // æ¬¡å›å®Ÿæ–½äºˆå®šæ—¥
  nextDueMileage  Int? // æ¬¡å›å®Ÿæ–½äºˆå®šè·é›¢
  tireType        String? // summer, winterï¼ˆã‚¿ã‚¤ãƒ¤äº¤æ›æ™‚ï¼‰
  performedBy     String? // ä½œæ¥­è€…ID
  performedByName String? // ä½œæ¥­è€…å
  notes           String?   @db.Text
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  vehicle Vehicle @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  vendor  Vendor? @relation(fields: [vendorId], references: [id])

  @@index([tenantId])
  @@index([vehicleId])
  @@index([tenantId, vehicleId])
  @@index([tenantId, type])
  @@map("maintenance_records")
}

// PCè³‡ç”£
model PCAsset {
  id           String  @id @default(cuid())
  tenantId     String
  assetNumber  String // è³‡ç”£ç•ªå·
  manufacturer String // ãƒ¡ãƒ¼ã‚«ãƒ¼
  model        String // å‹ç•ª
  serialNumber String // ã‚·ãƒªã‚¢ãƒ«ç•ªå·
  cpu          String? // CPU
  memory       String? // ãƒ¡ãƒ¢ãƒª
  storage      String? // ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
  os           String? // OS

  // å‰²å½“æƒ…å ±
  assignedUserId   String? // å‰²å½“ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
  assignedUserName String? // å‰²å½“ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼ˆå‚ç…§ç”¨ï¼‰
  assignedDate     DateTime? @db.Date // å‰²å½“æ—¥

  // æ‰€æœ‰ãƒ»ãƒªãƒ¼ã‚¹æƒ…å ±
  ownershipType    String    @default("owned") // owned, leased, rental
  purchaseDate     DateTime? @db.Date // è³¼å…¥æ—¥
  purchaseCost     Int? // è³¼å…¥ä¾¡æ ¼
  leaseCompany     String? // ãƒªãƒ¼ã‚¹ä¼šç¤¾
  leaseMonthlyCost Int? // ãƒªãƒ¼ã‚¹æœˆé¡
  leaseStartDate   DateTime? @db.Date // ãƒªãƒ¼ã‚¹é–‹å§‹æ—¥
  leaseEndDate     DateTime? @db.Date // ãƒªãƒ¼ã‚¹çµ‚äº†æ—¥
  leaseContact     String? // ãƒªãƒ¼ã‚¹æ‹…å½“è€…
  leasePhone       String? // ãƒªãƒ¼ã‚¹é›»è©±ç•ªå·

  // æœŸé™ç®¡ç†
  warrantyExpiration DateTime? @db.Date // ä¿è¨¼æœŸé™

  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  status String @default("active") // active, maintenance, retired

  notes     String?  @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  softwareLicenses SoftwareLicense[]
  repairRecords    RepairRecord[]

  @@unique([tenantId, assetNumber])
  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, assignedUserId])
  @@map("pc_assets")
}

// æ±ç”¨è³‡ç”£ï¼ˆãƒ¢ãƒ‹ã‚¿ãƒ¼ã€ãƒ—ãƒªãƒ³ã‚¿ãƒ¼ã€ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ç­‰ï¼‰
model GeneralAsset {
  id             String  @id @default(cuid())
  tenantId       String
  assetNumber    String // è³‡ç”£ç•ªå·
  category       String // monitor, printer, phone, tablet, network_device, other
  name           String // è³‡ç”£å
  manufacturer   String? // ãƒ¡ãƒ¼ã‚«ãƒ¼
  model          String? // å‹ç•ª
  serialNumber   String? // ã‚·ãƒªã‚¢ãƒ«ç•ªå·
  specifications Json? // ä»•æ§˜è©³ç´°ï¼ˆã‚«ãƒ†ã‚´ãƒªåˆ¥ï¼‰

  // å‰²å½“æƒ…å ±
  assignedUserId   String? // å‰²å½“ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
  assignedUserName String? // å‰²å½“ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼ˆå‚ç…§ç”¨ï¼‰
  assignedDate     DateTime? @db.Date // å‰²å½“æ—¥

  // æ‰€æœ‰ãƒ»ãƒªãƒ¼ã‚¹æƒ…å ±
  ownershipType    String    @default("owned") // owned, leased, rental
  purchaseDate     DateTime? @db.Date // è³¼å…¥æ—¥
  purchaseCost     Int? // è³¼å…¥ä¾¡æ ¼
  leaseCompany     String? // ãƒªãƒ¼ã‚¹ä¼šç¤¾
  leaseMonthlyCost Int? // ãƒªãƒ¼ã‚¹æœˆé¡
  leaseStartDate   DateTime? @db.Date // ãƒªãƒ¼ã‚¹é–‹å§‹æ—¥
  leaseEndDate     DateTime? @db.Date // ãƒªãƒ¼ã‚¹çµ‚äº†æ—¥

  // æœŸé™ç®¡ç†
  warrantyExpiration DateTime? @db.Date // ä¿è¨¼æœŸé™

  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  status String @default("active") // active, maintenance, retired

  notes     String?  @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  repairRecords RepairRecord[]

  @@unique([tenantId, assetNumber])
  @@index([tenantId])
  @@index([tenantId, category])
  @@index([tenantId, status])
  @@index([tenantId, assignedUserId])
  @@map("general_assets")
}

// ä¿®ç†è¨˜éŒ²ï¼ˆPCãƒ»ãã®ä»–è³‡ç”£å…±é€šï¼‰
model RepairRecord {
  id       String @id @default(cuid())
  tenantId String

  // è³‡ç”£å‚ç…§ï¼ˆPC ã¾ãŸã¯ æ±ç”¨è³‡ç”£ï¼‰
  pcAssetId      String? // PCè³‡ç”£ID
  generalAssetId String? // æ±ç”¨è³‡ç”£ID

  // ä¿®ç†æƒ…å ±
  repairType  String // screen, battery, keyboard, storage, power_supply, network, other
  date        DateTime @db.Date
  cost        Int // è²»ç”¨
  vendorId    String? // æ¥­è€…ID
  vendorName  String? // æ¥­è€…åï¼ˆå‚ç…§ç”¨ï¼‰
  symptom     String? // ç—‡çŠ¶
  description String? // ä½œæ¥­å†…å®¹

  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  status        String    @default("completed") // pending, in_progress, completed
  completedDate DateTime? @db.Date // å®Œäº†æ—¥

  performedBy     String? // ä½œæ¥­è€…ID
  performedByName String? // ä½œæ¥­è€…å
  notes           String?  @db.Text
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  pcAsset      PCAsset?      @relation(fields: [pcAssetId], references: [id], onDelete: Cascade)
  generalAsset GeneralAsset? @relation(fields: [generalAssetId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([pcAssetId])
  @@index([generalAssetId])
  @@index([tenantId, repairType])
  @@index([tenantId, date])
  @@map("repair_records")
}

// ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ï¼ˆPCç´ã¥ã‘ï¼‰
model SoftwareLicense {
  id             String    @id @default(cuid())
  tenantId       String
  pcAssetId      String
  softwareName   String // ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢å
  licenseKey     String? // ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚­ãƒ¼
  expirationDate DateTime? @db.Date // æœŸé™
  monthlyCost    Int? // æœˆé¡è²»ç”¨
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  // Relations
  pcAsset PCAsset @relation(fields: [pcAssetId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([pcAssetId])
  @@map("software_licenses")
}

// ========================================
// SaaSç®¡ç†
// ========================================

// SaaSã‚µãƒ¼ãƒ“ã‚¹ãƒã‚¹ã‚¿
model SaaSService {
  id          String  @id @default(cuid())
  tenantId    String
  name        String // ã‚µãƒ¼ãƒ“ã‚¹å
  category    String // communication, productivity, development, design, hr, finance, marketing, sales, security, storage, other
  vendor      String? // ãƒ™ãƒ³ãƒ€ãƒ¼å
  website     String? // å…¬å¼ã‚µã‚¤ãƒˆ
  logo        String? // ãƒ­ã‚´URL
  description String? @db.Text

  // å¥‘ç´„ã‚¿ã‚¤ãƒ—
  licenseType String // user-based, fixed, usage-based

  // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æƒ…å ±
  securityRating String? // A, B, C, D
  ssoEnabled     Boolean @default(false)
  mfaEnabled     Boolean @default(false)

  // ç®¡ç†æƒ…å ±
  adminEmail        String?
  supportUrl        String?
  contractStartDate DateTime? @db.Date
  contractEndDate   DateTime? @db.Date
  autoRenew         Boolean   @default(false)

  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  plans        SaaSLicensePlan[]
  assignments  SaaSLicenseAssignment[]
  monthlyCosts SaaSMonthlyCost[]

  @@unique([tenantId, name])
  @@index([tenantId])
  @@index([tenantId, category])
  @@index([tenantId, isActive])
  @@map("saas_services")
}

// SaaSãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãƒ—ãƒ©ãƒ³
model SaaSLicensePlan {
  id           String   @id @default(cuid())
  tenantId     String
  serviceId    String
  planName     String // ãƒ—ãƒ©ãƒ³å
  billingCycle String // monthly, yearly
  pricePerUser Int? // ãƒ¦ãƒ¼ã‚¶ãƒ¼å˜ä¾¡ï¼ˆuser-basedï¼‰
  fixedPrice   Int? // å›ºå®šä¾¡æ ¼ï¼ˆfixedï¼‰
  currency     String   @default("JPY") // JPY, USD
  maxUsers     Int? // æœ€å¤§ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°
  features     String[] // æ©Ÿèƒ½ãƒªã‚¹ãƒˆ
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  service     SaaSService             @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  assignments SaaSLicenseAssignment[]

  @@index([tenantId])
  @@index([serviceId])
  @@map("saas_license_plans")
}

// SaaSãƒ©ã‚¤ã‚»ãƒ³ã‚¹å‰²ã‚Šå½“ã¦
model SaaSLicenseAssignment {
  id        String @id @default(cuid())
  tenantId  String
  serviceId String
  planId    String

  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ©ã‚¤ã‚»ãƒ³ã‚¹å‹ã®å ´åˆ
  userId    String? // ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
  userName  String? // ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼ˆå‚ç…§ç”¨ï¼‰
  userEmail String? // ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹

  // å›ºå®šå¥‘ç´„å‹ã®å ´åˆ
  departmentId   String? // éƒ¨ç½²ID
  departmentName String? // éƒ¨ç½²åï¼ˆå‚ç…§ç”¨ï¼‰

  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  status       String    @default("active") // active, inactive, pending
  assignedDate DateTime  @db.Date
  revokedDate  DateTime? @db.Date

  // ä½¿ç”¨çŠ¶æ³
  lastUsedAt DateTime?
  usageCount Int? // æœˆæ¬¡ä½¿ç”¨å›æ•°

  notes     String?  @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  service SaaSService     @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  plan    SaaSLicensePlan @relation(fields: [planId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([serviceId])
  @@index([planId])
  @@index([tenantId, userId])
  @@index([tenantId, status])
  @@map("saas_license_assignments")
}

// SaaSæœˆæ¬¡ã‚³ã‚¹ãƒˆè¨˜éŒ²
model SaaSMonthlyCost {
  id               String   @id @default(cuid())
  tenantId         String
  serviceId        String
  period           String // YYYY-MM
  userLicenseCount Int      @default(0)
  userLicenseCost  Int      @default(0)
  fixedCost        Int      @default(0)
  usageCost        Int      @default(0)
  totalCost        Int      @default(0)
  currency         String   @default("JPY")
  activeUserIds    String[] // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãƒªã‚¹ãƒˆ
  inactiveUserIds  String[] // éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãƒªã‚¹ãƒˆ
  notes            String?  @db.Text
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Relations
  service SaaSService @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@unique([serviceId, period])
  @@index([tenantId])
  @@index([serviceId])
  @@index([tenantId, period])
  @@map("saas_monthly_costs")
}

// ========================================
// å¥åº·ç®¡ç†ï¼ˆHealth Managementï¼‰
// ========================================

// å¥åº·è¨ºæ–­
model HealthCheckup {
  id       String @id @default(cuid())
  tenantId String
  userId   String
  userName String // éæ­£è¦åŒ–ï¼ˆå‚ç…§ç”¨ï¼‰

  // å—è¨ºæƒ…å ±
  checkupDate        DateTime @db.Date // å—è¨ºæ—¥
  checkupType        String // regularï¼ˆå®šæœŸå¥è¨ºï¼‰, hiringï¼ˆé›‡å…¥æ™‚å¥è¨ºï¼‰, specificï¼ˆç‰¹å®šå¥è¨ºï¼‰
  medicalInstitution String? // åŒ»ç™‚æ©Ÿé–¢å
  fiscalYear         Int // å¹´åº¦

  // çµæœæ¦‚è¦
  overallResult     String // A, B, C, D, Eï¼ˆç·åˆåˆ¤å®šï¼‰
  requiresReexam    Boolean @default(false) // è¦å†æ¤œæŸ»
  requiresTreatment Boolean @default(false) // è¦æ²»ç™‚
  requiresGuidance  Boolean @default(false) // è¦ä¿å¥æŒ‡å°

  // èº«ä½“æ¸¬å®š
  height             Float? // èº«é•·(cm)
  weight             Float? // ä½“é‡(kg)
  bmi                Float? // BMI
  waistCircumference Float? // è…¹å›²(cm)
  eyesightLeft       Float? // è¦–åŠ›ï¼ˆå·¦ï¼‰
  eyesightRight      Float? // è¦–åŠ›ï¼ˆå³ï¼‰
  hearingLeft        String? // è´åŠ›ï¼ˆå·¦ï¼‰normal/abnormal
  hearingRight       String? // è´åŠ›ï¼ˆå³ï¼‰normal/abnormal

  // è¡€åœ§
  bloodPressureSystolic  Int? // åç¸®æœŸè¡€åœ§
  bloodPressureDiastolic Int? // æ‹¡å¼µæœŸè¡€åœ§

  // è¡€æ¶²æ¤œæŸ»
  bloodGlucose   Float? // ç©ºè…¹æ™‚è¡€ç³–
  hba1c          Float? // HbA1c
  triglycerides  Float? // ä¸­æ€§è„‚è‚ª
  hdlCholesterol Float? // HDLã‚³ãƒ¬ã‚¹ãƒ†ãƒ­ãƒ¼ãƒ«
  ldlCholesterol Float? // LDLã‚³ãƒ¬ã‚¹ãƒ†ãƒ­ãƒ¼ãƒ«
  got            Float? // GOT(AST)
  gpt            Float? // GPT(ALT)
  gammaGtp       Float? // Î³-GTP
  uricAcid       Float? // å°¿é…¸

  // å°¿æ¤œæŸ»
  urinaryProtein String? // å°¿è›‹ç™½ -, +-, +, ++, +++
  urinaryGlucose String? // å°¿ç³– -, +-, +, ++, +++

  // ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—
  followUpStatus String    @default("none") // none, scheduled, completed
  followUpDate   DateTime? @db.Date // ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—äºˆå®šæ—¥
  followUpNotes  String?   @db.Text // ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—ãƒ¡ãƒ¢

  // ç”£æ¥­åŒ»æ„è¦‹
  doctorOpinion   String? @db.Text // ç”£æ¥­åŒ»æ‰€è¦‹
  workRestriction String? // none, partial, fullï¼ˆå°±æ¥­åˆ¶é™ï¼‰

  // æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«
  attachments Json? // æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  findings HealthFinding[]

  @@index([tenantId])
  @@index([userId])
  @@index([tenantId, userId])
  @@index([tenantId, fiscalYear])
  @@index([tenantId, checkupDate])
  @@map("health_checkups")
}

// å¥åº·è¨ºæ–­æ‰€è¦‹
model HealthFinding {
  id             String   @id @default(cuid())
  checkupId      String
  category       String // æ¤œæŸ»ã‚«ãƒ†ã‚´ãƒªï¼ˆblood_pressure, blood_sugar, lipid, liver, etc.ï¼‰
  finding        String // æ‰€è¦‹å†…å®¹
  severity       String // normal, caution, warning, critical
  recommendation String? // æ¨å¥¨äº‹é …
  createdAt      DateTime @default(now())

  // Relations
  checkup HealthCheckup @relation(fields: [checkupId], references: [id], onDelete: Cascade)

  @@index([checkupId])
  @@map("health_findings")
}

// ã‚¹ãƒˆãƒ¬ã‚¹ãƒã‚§ãƒƒã‚¯
model StressCheck {
  id       String @id @default(cuid())
  tenantId String
  userId   String
  userName String // éæ­£è¦åŒ–ï¼ˆå‚ç…§ç”¨ï¼‰

  // å®Ÿæ–½æƒ…å ±
  fiscalYear Int // å¹´åº¦
  checkDate  DateTime? @db.Date // å—æ¤œæ—¥
  status     String    @default("pending") // pending, in_progress, completed, interview_recommended

  // ã‚¹ã‚³ã‚¢ï¼ˆåšåŠ´çœæ¨™æº–57å•ç‰ˆï¼‰
  stressFactorsScore  Int? // Aç¾¤: ä»•äº‹ã®ã‚¹ãƒˆãƒ¬ã‚¹è¦å› ï¼ˆ17å• 17-68ç‚¹ï¼‰
  stressResponseScore Int? // Bç¾¤: å¿ƒèº«ã®ã‚¹ãƒˆãƒ¬ã‚¹åå¿œï¼ˆ29å• 29-116ç‚¹ï¼‰
  socialSupportScore  Int? // Cç¾¤: å‘¨å›²ã®ã‚µãƒãƒ¼ãƒˆï¼ˆ9å• 9-36ç‚¹ï¼‰
  totalScore          Int? // åˆè¨ˆã‚¹ã‚³ã‚¢

  // åˆ¤å®š
  isHighStress     Boolean @default(false) // é«˜ã‚¹ãƒˆãƒ¬ã‚¹è€…åˆ¤å®š
  highStressReason String? // é«˜ã‚¹ãƒˆãƒ¬ã‚¹åˆ¤å®šç†ç”±

  // é¢è«‡
  interviewRequested   Boolean   @default(false) // é¢è«‡ç”³å‡º
  interviewRequestedAt DateTime?
  interviewScheduled   Boolean   @default(false) // é¢è«‡äºˆå®š
  interviewScheduledAt DateTime?
  interviewCompleted   Boolean   @default(false) // é¢è«‡å®Œäº†
  interviewCompletedAt DateTime?
  interviewNotes       String?   @db.Text // é¢è«‡è¨˜éŒ²

  // ç”£æ¥­åŒ»æ„è¦‹
  doctorName    String? // å®Ÿæ–½è€…å
  doctorOpinion String? @db.Text // ç”£æ¥­åŒ»æ„è¦‹

  // å›ç­”ãƒ‡ãƒ¼ã‚¿ï¼ˆåŒ¿ååŒ–ã®ãŸã‚è©³ç´°ã¯ä¿å­˜ã—ãªã„é¸æŠã‚‚å¯èƒ½ï¼‰
  responses Json? // å›ç­”ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([tenantId, userId, fiscalYear]) // 1äºº1å¹´åº¦1å›
  @@index([tenantId])
  @@index([userId])
  @@index([tenantId, fiscalYear])
  @@index([tenantId, isHighStress])
  @@map("stress_checks")
}

// ã‚¹ãƒˆãƒ¬ã‚¹ãƒã‚§ãƒƒã‚¯è³ªå•ãƒã‚¹ã‚¿
model StressCheckQuestion {
  id             String   @id @default(cuid())
  tenantId       String? // nullã®å ´åˆã¯ã‚·ã‚¹ãƒ†ãƒ å…±é€š
  questionNumber Int // è³ªå•ç•ªå·ï¼ˆ1-57ï¼‰
  category       String // Aï¼ˆã‚¹ãƒˆãƒ¬ã‚¹è¦å› ï¼‰, Bï¼ˆã‚¹ãƒˆãƒ¬ã‚¹åå¿œï¼‰, Cï¼ˆã‚µãƒãƒ¼ãƒˆï¼‰
  subcategory    String // å°åˆ†é¡
  questionText   String // è³ªå•æ–‡
  isReverse      Boolean  @default(false) // é€†è»¢é …ç›®
  sortOrder      Int      @default(0)
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@unique([tenantId, questionNumber])
  @@index([tenantId])
  @@index([category])
  @@map("stress_check_questions")
}

// å¥åº·ç®¡ç†è¨­å®š
model HealthSettings {
  id       String @id @default(cuid())
  tenantId String @unique

  // å¥åº·è¨ºæ–­è¨­å®š
  checkupPeriodStart        Int     @default(4) // å—è¨ºæœŸé–“é–‹å§‹æœˆ
  checkupPeriodEnd          Int     @default(3) // å—è¨ºæœŸé–“çµ‚äº†æœˆ
  checkupReminderDays       Int     @default(30) // ãƒªãƒã‚¤ãƒ³ãƒ‰æ—¥æ•°
  requireCheckupForNewHires Boolean @default(true) // é›‡å…¥æ™‚å¥è¨ºå¿…é ˆ

  // ã‚¹ãƒˆãƒ¬ã‚¹ãƒã‚§ãƒƒã‚¯è¨­å®š
  stressCheckPeriodStart  Int     @default(10) // å®Ÿæ–½æœŸé–“é–‹å§‹æœˆ
  stressCheckPeriodEnd    Int     @default(11) // å®Ÿæ–½æœŸé–“çµ‚äº†æœˆ
  stressCheckReminderDays Int     @default(14) // ãƒªãƒã‚¤ãƒ³ãƒ‰æ—¥æ•°
  stressCheckRequired     Boolean @default(true) // å®Ÿæ–½ç¾©å‹™ï¼ˆ50äººä»¥ä¸Šï¼‰

  // é«˜ã‚¹ãƒˆãƒ¬ã‚¹è€…åˆ¤å®šåŸºæº–
  highStressThresholdA Int @default(77) // A+Bç¾¤ã®åˆè¨ˆç‚¹
  highStressThresholdB Int @default(63) // Bç¾¤ã®ã¿

  // ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™
  allowSelfView          Boolean @default(true) // æœ¬äººé–²è¦§å¯
  allowManagerViewStatus Boolean @default(true) // ä¸Šå¸ã®å—è¨ºçŠ¶æ³é–²è¦§å¯
  allowHrViewStats       Boolean @default(true) // äººäº‹ã®çµ±è¨ˆé–²è¦§å¯

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("health_settings")
}

// å¥åº·ç®¡ç†é–²è¦§ãƒ­ã‚°ï¼ˆè¦é…æ…®å€‹äººæƒ…å ±ã®ãŸã‚ï¼‰
model HealthAccessLog {
  id           String   @id @default(cuid())
  tenantId     String
  userId       String // é–²è¦§è€…
  targetUserId String // é–²è¦§å¯¾è±¡
  resourceType String // checkup, stress_check, report
  resourceId   String? // å¯¾è±¡ãƒªã‚½ãƒ¼ã‚¹ID
  action       String // view, export, print
  ipAddress    String?
  userAgent    String?
  createdAt    DateTime @default(now())

  @@index([tenantId])
  @@index([userId])
  @@index([targetUserId])
  @@index([tenantId, createdAt])
  @@map("health_access_logs")
}

// ========================================
// ãŠçŸ¥ã‚‰ã›ï¼ˆAnnouncementsï¼‰
// ========================================

// ãŠçŸ¥ã‚‰ã›
model Announcement {
  id       String @id @default(cuid())
  tenantId String

  // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
  title    String // ã‚¿ã‚¤ãƒˆãƒ«
  content  String @db.Text // æœ¬æ–‡
  type     String @default("general") // general, system, emergency, event, policy
  priority String @default("normal") // high, normal, low

  // å¯¾è±¡è€…è¨­å®š
  target            String   @default("all") // all, department, role
  targetDepartments String[] // å¯¾è±¡éƒ¨ç½²ãƒªã‚¹ãƒˆï¼ˆtarget=departmentã®å ´åˆï¼‰
  targetRoles       String[] // å¯¾è±¡ãƒ­ãƒ¼ãƒ«ãƒªã‚¹ãƒˆï¼ˆtarget=roleã®å ´åˆï¼‰

  // å…¬é–‹è¨­å®š
  published   Boolean   @default(false)
  publishedAt DateTime?
  startDate   DateTime  @db.Date // è¡¨ç¤ºé–‹å§‹æ—¥
  endDate     DateTime? @db.Date // è¡¨ç¤ºçµ‚äº†æ—¥

  // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¨­å®š
  requiresAction Boolean   @default(false) // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å¿…é ˆãƒ•ãƒ©ã‚°
  actionLabel    String? // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ãƒ©ãƒ™ãƒ«
  actionUrl      String? // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³URL
  actionDeadline DateTime? @db.Date // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æœŸé™

  // ä½œæˆè€…æƒ…å ±
  createdBy     String // ä½œæˆè€…ID
  createdByName String? // ä½œæˆè€…åï¼ˆéæ­£è¦åŒ–ï¼‰

  // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  reads AnnouncementRead[]

  @@index([tenantId])
  @@index([tenantId, published])
  @@index([tenantId, startDate])
  @@index([published, startDate, endDate])
  @@map("announcements")
}

// ãŠçŸ¥ã‚‰ã›æ—¢èª­çŠ¶æ…‹
model AnnouncementRead {
  id             String @id @default(cuid())
  tenantId       String
  announcementId String
  userId         String

  // æ—¢èª­æƒ…å ±
  readAt DateTime @default(now())

  // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Œäº†ï¼ˆrequiresAction=trueã®å ´åˆï¼‰
  actionCompleted   Boolean   @default(false)
  actionCompletedAt DateTime?

  // Relations
  announcement Announcement @relation(fields: [announcementId], references: [id], onDelete: Cascade)

  @@unique([announcementId, userId]) // 1ãƒ¦ãƒ¼ã‚¶ãƒ¼1ãŠçŸ¥ã‚‰ã›ã«å¯¾ã—ã¦1ãƒ¬ã‚³ãƒ¼ãƒ‰
  @@index([tenantId])
  @@index([announcementId])
  @@index([userId])
  @@index([tenantId, userId])
  @@map("announcement_reads")
}

// ========================================
// å¾“æ¥­å“¡ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ»ãƒã‚¤ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
// ========================================

// å¾“æ¥­å“¡ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ï¼ˆä¼šç¤¾ç®¡ç†æƒ…å ±ï¼‰
model EmployeeProfile {
  id       String @id @default(cuid())
  tenantId String
  userId   String @unique // 1ãƒ¦ãƒ¼ã‚¶ãƒ¼1ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«

  // åŸºæœ¬æƒ…å ±ï¼ˆä¼šç¤¾ç®¡ç†ï¼‰
  employeeNumber String? // ç¤¾å“¡ç•ªå·
  nameKana       String? // æ°åï¼ˆã‚«ãƒŠï¼‰
  birthDate      DateTime? @db.Date // ç”Ÿå¹´æœˆæ—¥
  gender         String? // male, female, other, prefer_not_to_say

  // é€£çµ¡å…ˆï¼ˆä¼šç¤¾ç®¡ç†ï¼‰
  phone            String? // é›»è©±ç•ªå·
  mobilePhone      String? // æºå¸¯é›»è©±
  postalCode       String? // éƒµä¾¿ç•ªå·
  address          String? // ä½æ‰€
  addressKana      String? // ä½æ‰€ï¼ˆã‚«ãƒŠï¼‰

  // ç·Šæ€¥é€£çµ¡å…ˆ
  emergencyContactName         String? // ç·Šæ€¥é€£çµ¡å…ˆæ°å
  emergencyContactRelation     String? // ç¶šæŸ„
  emergencyContactPhone        String? // ç·Šæ€¥é€£çµ¡å…ˆé›»è©±ç•ªå·

  // éŠ€è¡Œå£åº§æƒ…å ±
  bankName       String? // éŠ€è¡Œå
  bankBranch     String? // æ”¯åº—å
  bankAccountType String? // ordinaryï¼ˆæ™®é€šï¼‰, currentï¼ˆå½“åº§ï¼‰
  bankAccountNumber String? // å£åº§ç•ªå·
  bankAccountHolder String? // å£åº§åç¾©

  // é€šå‹¤æƒ…å ±
  commuteMethod   String? // train, bus, car, bicycle, walk, other
  commuteRoute    String? @db.Text // é€šå‹¤çµŒè·¯è©³ç´°
  commuteDistance Float? // é€šå‹¤è·é›¢ï¼ˆkmï¼‰
  commuteCost     Int? // é€šå‹¤è²»ï¼ˆå††/æœˆï¼‰

  // é›‡ç”¨æƒ…å ±
  employmentType  String? // full_time, part_time, contract, temporary
  contractEndDate DateTime? @db.Date // å¥‘ç´„çµ‚äº†æ—¥ï¼ˆå¥‘ç´„ç¤¾å“¡ã®å ´åˆï¼‰

  // çµ±è¨ˆæƒ…å ±ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰
  completedProjectsCount Int @default(0)
  teamMembersCount       Int @default(0)
  yearsOfExperience      Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  certifications Certification[]
  skills         EmployeeSkill[]
  experiences    WorkExperience[]
  achievements   Achievement[]

  @@index([tenantId])
  @@index([userId])
  @@index([tenantId, employeeNumber])
  @@map("employee_profiles")
}

// è³‡æ ¼ãƒ»å…è¨±ãƒ»èªå®š
model Certification {
  id        String @id @default(cuid())
  tenantId  String
  profileId String
  userId    String // éæ­£è¦åŒ–ï¼ˆæ¤œç´¢ç”¨ï¼‰

  // è³‡æ ¼æƒ…å ±
  name           String // è³‡æ ¼å
  organization   String // ç™ºè¡Œæ©Ÿé–¢
  issueDate      DateTime @db.Date // å–å¾—æ—¥
  expiryDate     DateTime? @db.Date // æœ‰åŠ¹æœŸé™ï¼ˆnullã¯ç„¡æœŸé™ï¼‰
  credentialId   String? // èªå®šç•ªå·

  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  status String @default("active") // active, expiring, expired

  // æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«
  documentUrl  String? // è¨¼æ˜æ›¸ãƒ•ã‚¡ã‚¤ãƒ«URL
  documentName String? // ãƒ•ã‚¡ã‚¤ãƒ«å
  documentSize String? // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º

  // ãƒ¡ãƒ¢
  notes String? @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  profile       EmployeeProfile           @relation(fields: [profileId], references: [id], onDelete: Cascade)
  notifications CertificationNotification[]
  renewals      CertificationRenewal[]

  @@index([tenantId])
  @@index([profileId])
  @@index([userId])
  @@index([tenantId, status])
  @@index([tenantId, expiryDate])
  @@map("certifications")
}

// ã‚¹ã‚­ãƒ«ãƒ»å°‚é–€æ€§
model EmployeeSkill {
  id        String @id @default(cuid())
  tenantId  String
  profileId String
  userId    String // éæ­£è¦åŒ–ï¼ˆæ¤œç´¢ç”¨ï¼‰

  // ã‚¹ã‚­ãƒ«æƒ…å ±
  name     String // ã‚¹ã‚­ãƒ«å
  category String // ã‚¯ãƒ©ã‚¦ãƒ‰, ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰, ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰, ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹, BI, CRM, ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°, etc.
  level    Int    @default(50) // ç†Ÿç·´åº¦ï¼ˆ0-100ï¼‰

  // è‡ªå·±è©•ä¾¡ãƒ»ä»–è€…è©•ä¾¡
  selfAssessment     Int? // è‡ªå·±è©•ä¾¡
  managerAssessment  Int? // ä¸Šå¸è©•ä¾¡
  assessedAt         DateTime? // è©•ä¾¡æ—¥

  notes String? @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  profile EmployeeProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@unique([profileId, name]) // åŒä¸€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å†…ã§ã‚¹ã‚­ãƒ«åã¯é‡è¤‡ä¸å¯
  @@index([tenantId])
  @@index([profileId])
  @@index([userId])
  @@index([tenantId, category])
  @@map("employee_skills")
}

// çµŒæ­´ï¼ˆè·æ­´ï¼‰
model WorkExperience {
  id        String @id @default(cuid())
  tenantId  String
  profileId String
  userId    String // éæ­£è¦åŒ–ï¼ˆæ¤œç´¢ç”¨ï¼‰

  // çµŒæ­´æƒ…å ±
  position    String // å½¹è·
  company     String // ä¼šç¤¾å
  startDate   DateTime @db.Date // é–‹å§‹æ—¥
  endDate     DateTime? @db.Date // çµ‚äº†æ—¥ï¼ˆnullã¯ç¾åœ¨ï¼‰
  isCurrent   Boolean @default(false) // ç¾è·ãƒ•ãƒ©ã‚°
  description String? @db.Text // è·å‹™å†…å®¹

  // å®Ÿç¸¾
  achievements String[] // ä¸»ãªæˆæœ

  // ä½¿ç”¨ã‚¹ã‚­ãƒ«
  skills String[] // ã‚¿ã‚°ã¨ã—ã¦ä½¿ç”¨ã—ãŸã‚¹ã‚­ãƒ«

  // è¡¨ç¤ºé †åº
  sortOrder Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  profile EmployeeProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([profileId])
  @@index([userId])
  @@index([tenantId, isCurrent])
  @@map("work_experiences")
}

// å®Ÿç¸¾ãƒ»æˆæœ
model Achievement {
  id        String @id @default(cuid())
  tenantId  String
  profileId String
  userId    String // éæ­£è¦åŒ–ï¼ˆæ¤œç´¢ç”¨ï¼‰

  // å®Ÿç¸¾æƒ…å ±
  title       String // ã‚¿ã‚¤ãƒˆãƒ«
  description String? @db.Text // èª¬æ˜
  date        DateTime @db.Date // é”æˆæ—¥
  category    String? // project, award, publication, patent, etc.

  // æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«
  attachments Json? // [{name, url, size}]

  // å…¬é–‹è¨­å®š
  isPublic Boolean @default(true) // ç¤¾å†…å…¬é–‹

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  profile EmployeeProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([profileId])
  @@index([userId])
  @@index([tenantId, category])
  @@map("achievements")
}

// å¤‰æ›´ç”³è«‹ï¼ˆå¾“æ¥­å“¡æƒ…å ±ã®å¤‰æ›´ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰
model EmployeeChangeRequest {
  id       String @id @default(cuid())
  tenantId String
  userId   String // ç”³è«‹è€…

  // å¤‰æ›´å†…å®¹
  requestType String // basic_info, certification, skill, experience, achievement
  fieldName   String? // å¤‰æ›´ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åï¼ˆbasic_infoã®å ´åˆï¼‰
  currentValue String? @db.Text // ç¾åœ¨ã®å€¤
  newValue    String @db.Text // æ–°ã—ã„å€¤
  reason      String? @db.Text // å¤‰æ›´ç†ç”±

  // æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆè³‡æ ¼è¨¼æ˜æ›¸ãªã©ï¼‰
  attachments Json? // [{name, url, size}]

  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  status String @default("pending") // pending, approved, rejected, cancelled

  // æ‰¿èªæƒ…å ±
  reviewedBy     String? // æ‰¿èªè€…ID
  reviewedByName String? // æ‰¿èªè€…å
  reviewedAt     DateTime? // æ‰¿èªæ—¥æ™‚
  reviewComment  String? @db.Text // æ‰¿èª/å´ä¸‹ã‚³ãƒ¡ãƒ³ãƒˆ

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([tenantId])
  @@index([userId])
  @@index([tenantId, status])
  @@index([tenantId, requestType])
  @@map("employee_change_requests")
}

// ãƒã‚¤ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å€‹äººè¨­å®šï¼‰
model UserAccountSettings {
  id       String @id @default(cuid())
  tenantId String
  userId   String @unique // 1ãƒ¦ãƒ¼ã‚¶ãƒ¼1è¨­å®š

  // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®šï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè‡ªç”±ã«ç·¨é›†å¯èƒ½ï¼‰
  displayName String? // è¡¨ç¤ºåï¼ˆãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ï¼‰
  avatar      String? // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒURL
  bio         String? @db.Text // è‡ªå·±ç´¹ä»‹

  // å¤–è¦³è¨­å®š
  theme       String @default("system") // light, dark, system
  language    String @default("ja") // ja, en
  timezone    String @default("Asia/Tokyo")
  dateFormat  String @default("YYYY/MM/DD")
  timeFormat  String @default("24h") // 12h, 24h

  // é€šçŸ¥è¨­å®š
  emailNotifications    Boolean @default(true)
  pushNotifications     Boolean @default(true)
  workflowNotifications Boolean @default(true) // ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼é€šçŸ¥
  leaveNotifications    Boolean @default(true) // ä¼‘æš‡é€šçŸ¥
  systemNotifications   Boolean @default(true) // ã‚·ã‚¹ãƒ†ãƒ é€šçŸ¥
  announcementNotifications Boolean @default(true) // ãŠçŸ¥ã‚‰ã›é€šçŸ¥

  // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
  twoFactorEnabled  Boolean @default(false)
  twoFactorSecret   String? // æš—å·åŒ–ã•ã‚ŒãŸ2FAã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ
  passwordChangedAt DateTime? // æœ€çµ‚ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´æ—¥æ™‚

  // ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ï¼ˆå‚è€ƒç”¨ï¼‰
  lastLoginAt     DateTime? // æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³æ—¥æ™‚
  lastLoginIp     String? // æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³IP
  lastLoginDevice String? // æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³ãƒ‡ãƒã‚¤ã‚¹

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([tenantId])
  @@index([userId])
  @@map("user_account_settings")
}

// ==============================================
// è³‡æ ¼æœ‰åŠ¹æœŸé™é€šçŸ¥ãƒ»æ›´æ–°ç¢ºèªã‚·ã‚¹ãƒ†ãƒ 
// ==============================================

// è³‡æ ¼é€šçŸ¥è¨­å®šï¼ˆãƒ†ãƒŠãƒ³ãƒˆå˜ä½ï¼‰
model CertificationNotificationSettings {
  id       String @id @default(cuid())
  tenantId String @unique

  // é€šçŸ¥ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆæœŸé™å‰æ—¥æ•°ã®é…åˆ—ï¼‰
  notificationDays Int[] @default([90, 60, 30, 14, 7])

  // é€šçŸ¥ãƒãƒ£ãƒãƒ«è¨­å®š
  enableEmailNotification Boolean @default(true)
  enablePushNotification  Boolean @default(true)
  enableInAppNotification Boolean @default(true)

  // ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šï¼ˆä½•æ—¥å‰ã‹ã‚‰ä¸Šé•·ãƒ»äººäº‹ã«é€šçŸ¥ã™ã‚‹ã‹ï¼‰
  escalateToManagerDays Int @default(30) // 30æ—¥å‰ã‹ã‚‰ä¸Šé•·ã«é€šçŸ¥
  escalateToHrDays      Int @default(14) // 14æ—¥å‰ã‹ã‚‰äººäº‹ã«é€šçŸ¥

  // è‡ªå‹•ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°è¨­å®š
  autoUpdateStatus         Boolean @default(true) // æœŸé™åˆ‡ã‚Œæ™‚ã«è‡ªå‹•ã§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´
  warningThresholdDays     Int     @default(30) // expiringã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã«å¤‰æ›´ã™ã‚‹æ—¥æ•°

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("certification_notification_settings")
}

// è³‡æ ¼é€šçŸ¥å±¥æ­´
model CertificationNotification {
  id              String @id @default(cuid())
  tenantId        String
  certificationId String
  userId          String

  // é€šçŸ¥ã‚¿ã‚¤ãƒ—ã¨æœŸé™
  notificationType  String // early, standard, warning, urgent, final, expired
  daysUntilExpiry   Int    // é€šçŸ¥æ™‚ç‚¹ã§ã®æ®‹ã‚Šæ—¥æ•°

  // é€šçŸ¥çŠ¶æ…‹
  sentAt         DateTime? // é€ä¿¡æ—¥æ™‚
  readAt         DateTime? // æ—¢èª­æ—¥æ™‚
  acknowledgedAt DateTime? // ç¢ºèªæ¸ˆã¿æ—¥æ™‚ï¼ˆæœ¬äººãŒã€Œå¯¾å¿œã™ã‚‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ï¼‰

  // é€šçŸ¥ãƒãƒ£ãƒãƒ«åˆ¥é€ä¿¡çŠ¶æ…‹
  emailSent  Boolean @default(false)
  pushSent   Boolean @default(false)
  inAppSent  Boolean @default(false)

  // ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  escalatedToManager Boolean @default(false) // ä¸Šé•·ã«é€šçŸ¥æ¸ˆã¿
  escalatedToHr      Boolean @default(false) // äººäº‹ã«é€šçŸ¥æ¸ˆã¿
  managerNotifiedAt  DateTime? // ä¸Šé•·é€šçŸ¥æ—¥æ™‚
  hrNotifiedAt       DateTime? // äººäº‹é€šçŸ¥æ—¥æ™‚

  createdAt DateTime @default(now())

  // Relations
  certification Certification @relation(fields: [certificationId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([userId])
  @@index([certificationId])
  @@index([tenantId, userId])
  @@index([tenantId, notificationType])
  @@index([sentAt])
  @@map("certification_notifications")
}

// è³‡æ ¼æ›´æ–°ç”³è«‹
model CertificationRenewal {
  id              String @id @default(cuid())
  tenantId        String
  certificationId String
  userId          String

  // æ›´æ–°å¾Œã®æƒ…å ±
  newIssueDate     DateTime  @db.Date // æ–°ã—ã„ç™ºè¡Œæ—¥
  newExpiryDate    DateTime? @db.Date // æ–°ã—ã„æœ‰åŠ¹æœŸé™
  newCredentialId  String?            // æ–°ã—ã„èªå®šç•ªå·
  newDocumentUrl   String?            // æ–°ã—ã„è¨¼æ˜æ›¸ãƒ•ã‚¡ã‚¤ãƒ«URL
  newDocumentName  String?            // ãƒ•ã‚¡ã‚¤ãƒ«å

  // ç”³è«‹å‚™è€ƒ
  notes String? @db.Text

  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†
  status String @default("pending") // pending, under_review, approved, rejected

  // å¯©æŸ»æƒ…å ±
  reviewedBy     String?   // å¯©æŸ»è€…ID
  reviewedByName String?   // å¯©æŸ»è€…å
  reviewedAt     DateTime? // å¯©æŸ»æ—¥æ™‚
  reviewComment  String?   @db.Text // å¯©æŸ»ã‚³ãƒ¡ãƒ³ãƒˆ

  // ç¢ºèªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆç®¡ç†è€…ãŒç¢ºèªã—ãŸé …ç›®ï¼‰
  documentVerified     Boolean @default(false) // è¨¼æ˜æ›¸ã®çœŸæ­£æ€§ç¢ºèª
  dateVerified         Boolean @default(false) // æ—¥ä»˜ã®æ•´åˆæ€§ç¢ºèª
  organizationVerified Boolean @default(false) // ç™ºè¡Œæ©Ÿé–¢ã®ç¢ºèª

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  certification Certification @relation(fields: [certificationId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([userId])
  @@index([certificationId])
  @@index([tenantId, status])
  @@index([tenantId, userId, status])
  @@map("certification_renewals")
}
